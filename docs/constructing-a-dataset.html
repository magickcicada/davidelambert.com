<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David E. Lambert" />

<meta name="date" content="2019-06-20" />

<title>Constructing a County Level Demographic &amp; Economic Dataset</title>

<script src="assets/vendor/rmarkdown/header-attrs-2.3/header-attrs.js"></script>
<link rel="stylesheet" href="assets/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=Montserrat:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=Zilla+Slab:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/theme.min.css">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







</head>

<body class="mx-auto">


<!-- IMPORT CUSTOM CODE STYLING (**AFTER** rmarkdown/pandoc PREAMBLE) -->
<link rel="stylesheet" href="assets/css/highlight.css">


<!-- BEGIN HEADER NAV -->
<header id="headNav">

    <!-- COLLAPSED HEADER & TOGGLER -->
    <div class="navbar navbar-light bg-primary">
        <div class="container d-flex">
            <a class="navbar-brand slab px-0">
                <strong>David E. Lambert</strong>
            </a>
            <button id="toggler" class="btn navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNav" aria-controls="mainNav" aria-expaned="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>


    <!-- EXPANDED NAV MENU/BIO -->
    <div id="mainNav" class="collapse bg-dark">
        <div class="container">
            <div class="row">


                <!-- TAG/BIO FOR LARGE SCREENS -->
                <div class="col d-none d-md-inline-block col-md-10 py-4 pl-4 pl-lg-5">
                    <h5 class="text-light">
                        Data Analysis // Data Visualization // Graphic Design
                    </h5>
                </div>

                <!-- TAG ONLY FOR SMALLER SCREENS -->
                <div class="col d-md-none col-6 py-4 pl-5">
                    <h5 class="text-light">
                        Data Analysis<br />
                        Data Visualization<br />
                        Graphic Design
                    </h5>
                </div>

                <!-- NAV MENU -->
                <div class="col d-inline-block py-4 mr-4 mr-lg-5">
                    <h5 class="text-light text-right">Menu</h5>
                    <ul class="list-unstyled text-right">
                        <li>
                            <a href="index.html" class="menu-link">Home</a>
                        </li>
                        <li>
                            <a href="projects.html" class="menu-link">Projects</a>
                        </li>
                        <li>
                            <a href="blog.html" class="menu-link">Blog</a>
                        </li>
                        <li>
                            <a href="about.html" class="menu-link" >About</a>
                        </li>
                        <li>
                            <a href="contact.html" class="menu-link">Contact</a>
                        </li>
                    </ul>
                </div>

            </div>
            <!-- END ROW -->
        
        </div>
        <!-- END CONTAINER -->

    </div>
    <!-- END EXPANDED NAV/BIO -->
</header>
<!-- END HEADER NAV -->



<!-- BEGIN MAIN SECTION -->
<main class="bg-white">
    <div class="container py-4 px-5">
        <div class="row px-5">
            <div class="col">
<!-- RMARKDOWN OUTPUT BEGINS BELOW -->


<!-- ============================================================================================ -->







<h1 class="title toc-ignore">Constructing a County Level Demographic &amp; Economic Dataset</h1>
<h4 class="author">David E. Lambert</h4>
<h4 class="date">2019-06-20</h4>



<p>The following constructs a county-level dataset of demographic &amp; economic data, mostly from the American Community Survey, the Bureau of Labor Statistics, and the National Center for Health Statistics. These data are used to construct a modified version of the Human Development Index as a benchmark of the quality of life for each county in the US. This project stemmed from another project involving voter turnout rates in the 2016 election, so turnout estimates are also included.</p>
<p>This is a VERY LONG POST, so sorry in advance. There’s a story behind it, but it’s long enough without one! I’m planning several other posts with visualizations and models based on this dataset, so I’ll update with a link to the background at some point.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(tidycensus) <span class="co"># access Census API</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(blscrapeR) <span class="co"># access BLS API</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(tidyverse) <span class="co"># like, everything</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">## -- Attaching packages ----------------------------------------------- tidyverse 1.3.0 --</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">## v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="co">## v tibble  3.0.1     v dplyr   1.0.0</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="co">## v tidyr   1.1.0     v stringr 1.4.0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co">## v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="co">## -- Conflicts -------------------------------------------------- tidyverse_conflicts() --</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="co">## x dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co">## x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
</div>
<div id="census-api-pull" class="section level2">
<h2>Census API Pull</h2>
<p>First, get the whole 2016 ACS 5-Year Estimates variable list for reference.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>vars16 &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2016</span>, <span class="st">&quot;acs5&quot;</span>, <span class="dt">cache =</span> T)</span></code></pre></div>
<div id="variable-lists" class="section level3">
<h3>Variable Lists</h3>
<div id="age-sex" class="section level4">
<h4>Age &amp; Sex</h4>
<p>ACS table <strong>B01001</strong> gives population counts by age group &amp; sex. Line items are:</p>
<ul>
<li><strong>001:</strong> Total Population</li>
<li><strong>002-025:</strong> Male Population
<ul>
<li><strong>002:</strong> Total,</li>
<li><strong>003:</strong> 0-4, <strong>004:</strong> 5-9, <strong>005:</strong> 10-14, <strong>006:</strong> 15-17, <strong>007:</strong> 18-19,</li>
<li><strong>008:</strong> 20, <strong>009:</strong> 21, <strong>010:</strong> 22-24, <strong>011:</strong> 25-29,</li>
<li><strong>012:</strong> 30-34, <strong>013:</strong> 35-39,</li>
<li><strong>014:</strong> 40-44, <strong>015:</strong> 45-49,</li>
<li><strong>016:</strong> 50-54, <strong>017:</strong> 55-59,</li>
<li><strong>018:</strong> 60-61, <strong>019:</strong> 62-64, <strong>020:</strong> 65-66, <strong>021:</strong> 67-69,</li>
<li><strong>022:</strong> 70-74, <strong>023:</strong> 75-79,</li>
<li><strong>024:</strong> 80-84, <strong>025:</strong> 85+</li>
</ul></li>
<li><strong>026-049:</strong> Female Population
<ul>
<li><strong>026:</strong> Total,</li>
<li><strong>027:</strong> 0-4, <strong>028:</strong> 5-9, <strong>029:</strong> 10-14, <strong>030:</strong> 15-17, <strong>031:</strong> 18-19,</li>
<li><strong>032:</strong> 20, <strong>033:</strong> 21, <strong>034:</strong> 22-24, <strong>035:</strong> 25-29,</li>
<li><strong>036:</strong> 30-34, <strong>037:</strong> 35-39,</li>
<li><strong>038:</strong> 40-44, <strong>039:</strong> 45-49,</li>
<li><strong>040:</strong> 50-54, <strong>041:</strong> 55-59,</li>
<li><strong>042:</strong> 60-61, <strong>043:</strong> 62-64, <strong>044:</strong> 65-66, <strong>045:</strong> 67-69,</li>
<li><strong>046:</strong> 70-74, <strong>047:</strong> 75-79,</li>
<li><strong>048:</strong> 80-84, <strong>049:</strong> 85+</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>age &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  <span class="kw">paste0</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span class="st">&quot;B01001_&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    <span class="kw">str_pad</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>      <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">49</span>,<span class="dv">1</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>      <span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>      <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>      <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>  )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="race-ethnicity" class="section level4">
<h4>Race &amp; Ethnicity</h4>
<p>Table <strong>B03002</strong> contains estimates of “Hispanic or Latino Origin by Race,” providing race counts within the ethnic groupings of Hispanic or Latino and <em>NOT</em> H/L. The following line items will allow a 7-way race/ethnicity categorization: White , Black , Hispanic or Latino of any race, Asian or Pacific Islander, American Indian or Alaskan Native, Two or More races, and Other. Line items are:</p>
<ul>
<li><strong>003:</strong> White alone</li>
<li><strong>004:</strong> Black or African American alone</li>
<li><strong>005:</strong> American Indian and Alaskan Native alone</li>
<li><strong>006:</strong> Asian alone</li>
<li><strong>007:</strong> Native Hawaiian and Other Pacific Islander alone</li>
<li><strong>008:</strong> Some other race alone</li>
<li><strong>009:</strong> Two or more races</li>
<li><strong>012:</strong> Hispanic or Latino (total of all races)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>race &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  <span class="kw">paste0</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    <span class="st">&quot;B03002_&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">str_pad</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>      <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">1</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>      <span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>      <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>      <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>  ),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>  <span class="st">&quot;B03002_012&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="educational-attainment" class="section level4">
<h4>Educational Attainment</h4>
<p><strong>B15003</strong> records attainment for the population 25 and over. Following Measure of America methodology, we need: HS or greater, Bachelor’s or greater, and any post-baccalaureate degree. These are available from:</p>
<ul>
<li>HS or greater, less than Bachelor’s:
<ul>
<li><strong>017:</strong> Regular high school diploma</li>
<li><strong>018:</strong> GED or alternative credential</li>
<li><strong>019:</strong> Some college, less than 1 year</li>
<li><strong>020:</strong> Some college, 1 or more years, no degree</li>
<li><strong>021:</strong> Associate’s degree</li>
</ul></li>
<li><strong>022:</strong> Bachelor’s degree</li>
<li>Graduate degree:
<ul>
<li><strong>023:</strong> Master’s degree</li>
<li><strong>024:</strong> Professional school degree</li>
<li><strong>025:</strong> Doctorate degree</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>attainment &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  <span class="kw">paste0</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    <span class="st">&quot;B15003_&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    <span class="kw">str_pad</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>      <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">17</span>,<span class="dv">25</span>,<span class="dv">1</span>)),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>      <span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>      <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>      <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  )</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="school-enrollment" class="section level4">
<h4>School Enrollment</h4>
<p><strong>B14001</strong> gives enrollment <em>for the population aged 3 and over</em>. * <strong>001</strong> gives the total 3+ population * <strong>002</strong> gives those enrolled.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>enrollment &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B14001_001&quot;</span>, <span class="st">&quot;B14001_002&quot;</span>)</span></code></pre></div>
</div>
<div id="economic-variables" class="section level4">
<h4>Economic Variables</h4>
<ul>
<li><strong>B20002_001</strong> gives county median personal earnings in the past 12 months, which is of course an average over 2012-2016.</li>
<li><strong>B19301_001</strong> gives county per capita income in the past 12 months, etc.</li>
<li><strong>B19083_001</strong> gives county Gini coefficient on income inequality.</li>
<li><strong>B27010</strong> gives health insurance coverage type by age:
<ul>
<li><strong>017:</strong> Under 18, no coverage</li>
<li><strong>033:</strong> 18-34, no coverage</li>
<li><strong>050:</strong> 35-64, no coverage</li>
<li><strong>066:</strong> 65+, no coverage</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>economic &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20002_001&quot;</span>, <span class="st">&quot;B19301_001&quot;</span>, <span class="st">&quot;B19083_001&quot;</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>              <span class="st">&quot;B27010_017&quot;</span>, <span class="st">&quot;B27010_033&quot;</span>, <span class="st">&quot;B27010_050&quot;</span>, <span class="st">&quot;B27010_066&quot;</span>)</span></code></pre></div>
</div>
<div id="voting-eligibility-adjustments" class="section level4">
<h4>Voting Eligibility Adjustments</h4>
<ul>
<li><strong>B05003</strong> gives nativity and citizenship status estimates by age &amp; sex:
<ul>
<li><strong>012:</strong> Male, 18 &amp; over, not a citizen</li>
<li><strong>023:</strong> Female, 18 &amp; over, not a citizen</li>
</ul></li>
<li><strong>B26001_001</strong> gives total group quarters population, type not specified</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>vepadjust &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B05003_012&quot;</span>, <span class="st">&quot;B05003_023&quot;</span>, <span class="st">&quot;B26001_001&quot;</span>)</span></code></pre></div>
</div>
<div id="combined-variable-list" class="section level4">
<h4>Combined Variable List</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>allvars &lt;-<span class="st"> </span><span class="kw">c</span>(age, race, attainment, enrollment, economic, vepadjust)</span></code></pre></div>
</div>
</div>
<div id="census-api-pull-1" class="section level3">
<h3>Census API Pull</h3>
<p>ACS variables - and importantly, geographic shapefiles from <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-geodatabase-file.html">Census TIGER</a> - are available from the Census Bureau API via <a href="https://walkerke.github.io/tidycensus/index.html">Kyle Walker’s tidycensus package</a>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>acspull &lt;-<span class="st"> </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">get_acs</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    <span class="dt">survey =</span> <span class="st">&quot;acs5&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="dt">year =</span> <span class="dv">2016</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    <span class="dt">variables =</span> allvars,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    <span class="dt">geometry =</span> <span class="ot">TRUE</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    <span class="dt">shift_geo =</span> <span class="ot">TRUE</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    <span class="dt">output =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;CENSUS_API_KEY&quot;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>  )</span></code></pre></div>
<p>Each variable has and estimate, suffixed “E”, and a margin of error, suffixed “M”. Subset only the estimate columns, plus GEOID (5-digit FIPS code as character), NAME (County Name, State Name), &amp; geometry (sf spatial data). Then remove the “E” suffix, not because its necessary, but because its annoying.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>acspull &lt;-<span class="st"> </span>acspull[, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="kw">which</span>(<span class="kw">str_ends</span>(<span class="kw">colnames</span>(acspull), <span class="st">&quot;[0-9]E&quot;</span>)), <span class="dv">159</span>)]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">colnames</span>(acspull) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GEOID&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>                       <span class="st">&quot;NAME&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>                       <span class="kw">str_sub</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>                         <span class="kw">colnames</span>(<span class="kw">as.data.frame</span>(acspull)[, <span class="dv">3</span><span class="op">:</span><span class="dv">80</span>]), <span class="dt">end =</span> <span class="dv">-2</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>                       ),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>                       <span class="st">&quot;geometry&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="initial-wrangling" class="section level2">
<h2>Initial Wrangling</h2>
<p>Rename, generate/mutate, &amp; subset</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>acspull <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>    <span class="dt">name =</span> NAME,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>    <span class="dt">poptotal =</span> B01001_<span class="dv">001</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>    <span class="dt">pop_3plus =</span> B14001_<span class="dv">001</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>    <span class="dt">enrolled =</span> B14001_<span class="dv">002</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>    <span class="dt">medearn =</span> B20002_<span class="dv">001</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>    <span class="dt">incpc =</span> B19301_<span class="dv">001</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>    <span class="dt">gini =</span> B19083_<span class="dv">001</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>    <span class="dt">gquart =</span> B26001_<span class="dv">001</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a>    <span class="dt">fips =</span> GEOID,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>    <span class="dt">pop_under18 =</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a>      B01001_<span class="dv">003</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">004</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">005</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">006</span> <span class="op">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">027</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">028</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">029</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">030</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a>    <span class="dt">pop_under25 =</span> pop_under18 <span class="op">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">007</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">008</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">009</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">010</span> <span class="op">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">031</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">032</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">033</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">034</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>    <span class="dt">pop_324 =</span> pop_under25 <span class="op">-</span><span class="st"> </span>(poptotal <span class="op">-</span><span class="st"> </span>pop_3plus),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a>    <span class="dt">pop_25plus =</span> poptotal <span class="op">-</span><span class="st"> </span>pop_under25,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a>    <span class="dt">pop_60plus =</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a>      B01001_<span class="dv">018</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">019</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">020</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">021</span> <span class="op">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">022</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">023</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">024</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">025</span> <span class="op">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">042</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">043</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">044</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">045</span> <span class="op">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a><span class="st">      </span>B01001_<span class="dv">046</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">046</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">048</span> <span class="op">+</span><span class="st"> </span>B01001_<span class="dv">049</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>    <span class="dt">old_prop =</span> pop_60plus <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a>    <span class="dt">female_prop =</span> B01001_<span class="dv">026</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>    <span class="dt">white_prop =</span> B03002_<span class="dv">003</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a>    <span class="dt">black_prop =</span> B03002_<span class="dv">004</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a>    <span class="dt">hisp_prop =</span> B03002_<span class="dv">012</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>    <span class="dt">aapi_prop =</span> (B03002_<span class="dv">006</span> <span class="op">+</span><span class="st"> </span>B03002_<span class="dv">007</span>) <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a>    <span class="dt">aian_prop =</span> B03002_<span class="dv">005</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a>    <span class="dt">other_prop =</span> B03002_<span class="dv">008</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a>    <span class="dt">multi_prop =</span> B03002_<span class="dv">009</span> <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a>    <span class="dt">hsetc =</span> B15003_<span class="dv">017</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">018</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">019</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">020</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">021</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>    <span class="dt">bacc =</span> B15003_<span class="dv">022</span>,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>    <span class="dt">grad =</span> B15003_<span class="dv">023</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">024</span> <span class="op">+</span><span class="st"> </span>B15003_<span class="dv">025</span>,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a>    <span class="dt">unins_prop =</span> (B27010_<span class="dv">017</span> <span class="op">+</span><span class="st"> </span>B27010_<span class="dv">033</span> <span class="op">+</span><span class="st"> </span>B27010_<span class="dv">050</span> <span class="op">+</span><span class="st"> </span>B27010_<span class="dv">066</span>) <span class="op">/</span><span class="st"> </span>poptotal,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>    <span class="dt">noncit =</span> B05003_<span class="dv">012</span> <span class="op">+</span><span class="st"> </span>B05003_<span class="dv">023</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a>    GEOID, fips, name, poptotal, pop_under18, noncit, gquart,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a>    pop_3plus, pop_under25, pop_<span class="dv">324</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true"></a>    pop_25plus, pop_60plus, old_prop,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true"></a>    female_prop, white_prop, black_prop, hisp_prop,</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true"></a>    aapi_prop, aian_prop, other_prop, multi_prop,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true"></a>    hsetc, bacc, grad, enrolled,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true"></a>    medearn, incpc, gini, unins_prop, geometry</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true"></a>  )</span></code></pre></div>
<p>Add some geographic identifiers: separated county name, state name, and state abbreviation from the internal dataset included with <code>tidycensus</code>. Also add Census Region &amp; Division from R internal datasets.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;fips_codes&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>fips_codes &lt;-<span class="st"> </span>fips_codes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fips =</span> <span class="kw">paste0</span>(state_code, county_code)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, state, state_name, county)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>regdiv &lt;-</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">state =</span> state.abb,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>         <span class="dt">region =</span> state.region,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>         <span class="dt">division =</span> state.division) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;South&quot;</span>, <span class="st">&quot;South Atlantic&quot;</span> ))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>fips_codes &lt;-<span class="st"> </span><span class="kw">left_join</span>(fips_codes, regdiv)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a><span class="co">## Joining, by = &quot;state&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span><span class="kw">left_join</span>(cnty, fips_codes)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">30</span><span class="op">:</span><span class="dv">32</span>, <span class="dv">3</span>, <span class="dv">33</span><span class="op">:</span><span class="dv">34</span>, <span class="dv">4</span><span class="op">:</span><span class="dv">29</span>, <span class="dv">35</span>)]</span></code></pre></div>
<div id="missing-value-aka-daggett-county" class="section level3">
<h3>Missing Value, AKA Daggett County</h3>
<p>Check for any missing values. There shouldn’t be any in ACS 5-Year data, but sometimes something gets overlooked, or the margins of error are wide enough that they include 0 due to small populations &amp; thus sample sizes.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">which</span>(<span class="kw">sapply</span>(cnty, anyNA))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="co">## medearn </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="co">##      31</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(medearn)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, county, state, poptotal, medearn, incpc)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a><span class="co">##    fips         county state poptotal medearn incpc</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a><span class="co">## 1 49009 Daggett County    UT      751      NA 27182</span></span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Daggett_County,_Utah">Daggett County, Utah</a> is missing median earnings, the only missing datum from the ACS 5-Year pull. This may be due to a sample size issue, since the population estimate is so low. It <em>does</em> have an estimate for per-capita income, indicating that there is <em>some</em> personal finance data available for the county. However per-capita income is a poor proxy for median earnings, since it is a mean across <em>all</em> population, including those under 16, who are excluded from the raw earnings data that goes into median earnings (not to mention the earnings/income distinction!).</p>
<p>To try and impute the missing value, we’ll look at some possible proxies from the ACS and compare them to the the ACS Public Use Microdata Area containing Daggett County and to the BLS’s <a href="https://www.bls.gov/cew/">Quarterly Census of Earnings &amp; Wages</a> (QCEW) data to see if we can come up with a reasonable, reliable estimate.</p>
<div id="county-level-acs-proxies" class="section level4">
<h4>County-Level ACS Proxies</h4>
<p>First, from the same county-level ACS 2016 5-Year estimates as the rest of the data, we’ll pull:</p>
<ul>
<li><strong>B08121:</strong> Median earnings by means of transportation to work, and</li>
<li><strong>B06011:</strong> Median income by place of birth in the United States (nativity)</li>
<li><strong>B20003:</strong> Aggregate earnings for the population 16 &amp; over, to be divided by:
<ul>
<li><strong>B23025:</strong> Employment status for the population 16 &amp; over, to get population figure</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>dag_vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B08121_001&quot;</span>, <span class="st">&quot;B06011_001&quot;</span>, <span class="st">&quot;B20003_001&quot;</span>, <span class="st">&quot;B23025_001&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>dag_cnty &lt;-<span class="st"> </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">get_acs</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>    <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>    <span class="dt">state =</span> <span class="st">&quot;UT&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="st">&quot;Daggett&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>    <span class="dt">variables =</span> dag_vars,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>    <span class="dt">year =</span> <span class="dv">2016</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>    <span class="dt">survey =</span> <span class="st">&quot;acs5&quot;</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>    <span class="dt">output =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>    <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;CENSUS_API_KEY&quot;</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a>    <span class="dt">medearn_trans =</span> B08121_001E,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>    <span class="dt">medinc_birth =</span> B06011_001E,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a>    <span class="dt">earnpc_wap =</span> <span class="kw">round</span>(B20003_001E <span class="op">/</span><span class="st"> </span>B23025_001E),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>    <span class="dt">fips =</span> GEOID,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>    <span class="dt">name =</span> NAME</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, name, medearn_trans, medinc_birth, earnpc_wap)</span></code></pre></div>
</div>
<div id="puma-level-acs-proxy" class="section level4">
<h4>PUMA-Level ACS Proxy</h4>
<p>Next we’ll pull the same <strong>B20002</strong> median earnings variable as before, but from the PUMA containing Daggett County, 49-13001: Southeast Utah &amp; Uintah Basin Region.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>dag_puma &lt;-<span class="st"> </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">get_acs</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>    <span class="dt">geography =</span> <span class="st">&quot;public use microdata area&quot;</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>    <span class="dt">state =</span> <span class="st">&quot;UT&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>    <span class="dt">variables =</span> <span class="st">&quot;B20002_001&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>    <span class="dt">year =</span> <span class="dv">2016</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>    <span class="dt">survey =</span> <span class="st">&quot;acs5&quot;</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>    <span class="dt">output =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>    <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;CENSUS_API_KEY&quot;</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(GEOID <span class="op">==</span><span class="st"> &quot;4913001&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">medearn_puma =</span> B20002_001E) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fips =</span> <span class="st">&quot;49009&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;Daggett County, Utah&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, name, medearn_puma)</span></code></pre></div>
</div>
<div id="qcew-bls-proxy" class="section level4">
<h4>QCEW (BLS) Proxy</h4>
<p>Next we’ll pull average annual wages for the county from the QCEW, using <a href="https://github.com/keberwein/blscrapeR">Kris Eberwein’s blscrapeR package</a>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>dag_qcew &lt;-<span class="st"> </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">bls_api</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    <span class="st">&quot;ENU4900950010&quot;</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>    <span class="dt">startyear =</span> <span class="dv">2016</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>    <span class="dt">endyear =</span> <span class="dv">2016</span>, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>    <span class="kw">Sys.getenv</span>(<span class="st">&quot;BLS_KEY&quot;</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">fips =</span> seriesID, <span class="dt">awage =</span> value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>    <span class="dt">fips =</span> <span class="kw">str_sub</span>(fips, <span class="dt">start =</span> <span class="dv">4</span>, <span class="dt">end =</span> <span class="dv">8</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>    <span class="dt">name =</span> <span class="st">&quot;Daggett County, Utah&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, name, awage)</span></code></pre></div>
</div>
<div id="comparison" class="section level4">
<h4>Comparison</h4>
<p>Finally, we’ll aggregate all these estimates and compare.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>dag &lt;-<span class="st"> </span><span class="kw">left_join</span>(dag_cnty, dag_puma) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(dag_qcew)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="co">## Joining, by = c(&quot;fips&quot;, &quot;name&quot;)</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="co">## Joining, by = c(&quot;fips&quot;, &quot;name&quot;)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>dag</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a><span class="co">## # A tibble: 1 x 7</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a><span class="co">##   fips  name            medearn_trans medinc_birth earnpc_wap medearn_puma awage</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a><span class="co">##   &lt;chr&gt; &lt;chr&gt;                   &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a><span class="co">## 1 49009 Daggett County~         60583        23214      25278        30178 32446</span></span></code></pre></div>
<p>The earnings by transportation to work (<code>medearn_trans</code>) estimate is <em>way</em> off from everything else. Perhaps a weird random sampling error. The estimates for median income by nativity (<code>medinc_birth</code>) and per capita earnings for the working age population (<code>earnpc_wap</code>) broadly agree, with estimates in the low-mid $20,000s. These are slightly lower than median earnings for the wider PUMA (<code>medearn_puma</code>), which makes sense because there would be greater heterogeneity in the larger sample, which would likely include many individuals with higher earnings, given the isolated, rural nature of <a href="https://en.wikipedia.org/wiki/Daggett_County,_Utah">Daggett County</a>.</p>
<p>I believe that the QCEW average annual wage estimate offers the best method to impute the missing median annual earnings datum. The QCEW wage data are <a href="https://www.bls.gov/cew/cewover.htm">drawn from mandatory administrative payroll reporting</a> (<a href="https://web.archive.org/web/20190202221219/https://www.bls.gov/cew/cewover.htm">archive</a>), offering &gt;95% coverage, and should be more reliable than the ACS samples for very low population counties like Daggett. “Wages” (which include “salaries” in this sense) also represent <a href="https://www.census.gov/newsroom/blogs/random-samplings/2010/09/income-vs-earnings.html">essentially the same definition as “earnings”</a> (<a href="https://web.archive.org/web/*/https://www.census.gov/newsroom/blogs/random-samplings/2010/09/income-vs-earnings.html">archive</a>), as opposed to the broader meaning of “income”, so the QCEW estimate gets at the same underlying data as ACS median earnings. However, the QCEW estimates <em>average</em> wages, rather than median. Since earnings, income, and wealth distributions are typically right-skewed, the average will be higher than the median, giving a possibly inaccurate imputation. Therefore, we will obtain QCEW average annual wages for <em>all</em> counties and model ACS median annual earnings as a function of thereof. We’ll predict the median earnings of Daggett County from this model to obtain a hopefully accurate imputation for the missing value.</p>
</div>
</div>
<div id="modeled-median-earnings" class="section level3">
<h3>Modeled Median Earnings</h3>
<p>First, we need to get the BLS series codes for all 3,142 counties in <code>cnty</code>. These are composed of a series prefix, the county’s full 5-digit FIPS code, and a specific identifier suffix.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="co"># vector of all 3,142 FIPS codes</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>allfips &lt;-<span class="st"> </span><span class="kw">sort</span>(cnty<span class="op">$</span>fips)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="co"># vector of BLS series IDs for each county</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>qcewseries &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;ENU&quot;</span>, allfips, <span class="st">&quot;50010&quot;</span>)</span></code></pre></div>
<p>The BLS API limits queries to 50 series at a time, so we need to split the <code>qcewseries</code> vector into chunks of 50 &amp; store them in a list. The <a href="https://stackoverflow.com/questions/3318333/split-a-vector-into-chunks-in-r">syntax I found on Stack Overflow</a> was a little opaque to me, so here’s an explanation for my own edification:</p>
<ul>
<li><code>seq_along(qcewseries)/50</code> divides each index of the vector by 50, so the 50th element will be 1, the 100th will be 2, etc., and the intervening values will be decimals.</li>
<li><code>ceiling(x)</code> rounds up to the next whole number. So the first 50 elements, with values now between 0.02-1.00, get a 1. The next 50, with values between 1.02-2.00 get a 2, etc. This essentially creates a factor, with each group of 50 assigned an integer level.</li>
<li><code>split(x, f)</code> splits x into groups according to factor f, which is why we needed the other functions.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>chunks_qcew &lt;-<span class="st"> </span><span class="kw">split</span>(qcewseries, <span class="kw">ceiling</span>(<span class="kw">seq_along</span>(qcewseries)<span class="op">/</span><span class="dv">50</span>))</span></code></pre></div>
<div id="qcew-pull" class="section level4">
<h4>QCEW Pull</h4>
<p>Next we a need a little function to so we can send each of the 63 chunks to the API. We can use this again later when we’re getting unemployment rates.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>bls2016 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">bls_api</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>      x,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>      <span class="dt">startyear =</span> <span class="st">&quot;2016&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>      <span class="dt">endyear =</span> <span class="st">&quot;2016&quot;</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>      <span class="dt">registrationKey =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BLS_KEY&quot;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>    )</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now we’ll <code>lapply</code> the function to the chunks. This returns a list of data frames, one for each chunk. So we’ll wrangle those into a single data frame &amp; do a little wrangling to retrieve the FIPS codes from the series IDs. (Note: the results of the API call are hidden because we don’t need to read “REQUEST_SUCCEEDED” 63 times.)</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>qcew_out &lt;-<span class="st"> </span><span class="kw">lapply</span>(chunks_qcew, bls2016)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>qcew &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(qcew_out) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fips =</span> <span class="kw">str_sub</span>(seriesID, <span class="dt">start =</span> <span class="dv">4</span>, <span class="dt">end =</span> <span class="dv">8</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">awage =</span> value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, awage) </span></code></pre></div>
</div>
<div id="qcew-plot-model" class="section level4">
<h4>QCEW Plot &amp; Model</h4>
<p>We’ll create a data frame with just FIPS, ACS median earnings, and QCEW average wages for modelling.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>emod_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(fips <span class="op">%in%</span><span class="st"> </span>qcew<span class="op">$</span>fips, county <span class="op">!=</span><span class="st"> &quot;Daggett County&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, medearn) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(qcew)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span></code></pre></div>
<p>A quick scatter plot with LOESS &amp; linear fits to make sure a simple OLS model makes sense.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> emod_df, <span class="kw">aes</span>(<span class="dt">x =</span> awage, <span class="dt">y =</span> medearn)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>    <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;LOESS&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;LOESS&quot;</span>), </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;OLS&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;OLS&quot;</span>),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;Model&quot;</span>) <span class="op">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;Model&quot;</span>) <span class="op">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a><span class="co">## `geom_smooth()` using formula &#39;y ~ x&#39;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a><span class="co">## `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="assets/img/earnings%20model%20plot-1.png" width="672" /></p>
<p>OLS looks decent enough to me, with plenty of data &amp; considerable overlap in the low $32,000 <code>awage</code> range. We’ll run a simple regression to get predicted median earnings for Daggett County’s average wages.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>emod_model &lt;-<span class="st"> </span><span class="kw">lm</span>(medearn <span class="op">~</span><span class="st"> </span>awage, <span class="dt">data =</span> emod_df)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>dag_pred &lt;-</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(emod_model, <span class="kw">data.frame</span>(<span class="dt">awage =</span> qcew<span class="op">$</span>awage[qcew<span class="op">$</span>fips <span class="op">==</span><span class="st"> &quot;49009&quot;</span>])) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>dag_pred</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a><span class="co">##     1 </span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a><span class="co">## 25874</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>dag<span class="op">$</span>earnpc_wap</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a><span class="co">## [1] 25278</span></span></code></pre></div>
<p>The predicted value of $25,874 is quite close to the ACS estimate of per capita earnings for the working age population, $25278, which lends some credence to the imputation model. We’ll fill the imputed value and double-check that there are no longer any missings.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>cnty<span class="op">$</span>medearn[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> &quot;49009&quot;</span>] &lt;-<span class="st"> </span>dag_pred</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a><span class="kw">which</span>(<span class="kw">sapply</span>(cnty, anyNA))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a><span class="co">## named integer(0)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="vap-vep-estimates" class="section level2">
<h2>VAP &amp; VEP Estimates</h2>
<p>We’ll generate 5 different estimates from which to calculate 2016 voter turnout. VAP, or voting-age population, is the estimated county population age 18 &amp; over. We’ll also generate different estimates of VEP, or voting <em>eligible</em> population, excluding ineligible adult populations like non-citizens and current felons.</p>
<div id="vap" class="section level3">
<h3>VAP</h3>
<p>Simple voting age population: population 18 &amp; over</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vap =</span> poptotal <span class="op">-</span><span class="st"> </span>pop_under18)</span></code></pre></div>
</div>
<div id="vep-1" class="section level3">
<h3>VEP 1</h3>
<p>VEP 1 subtracts non-citizens aged 18 &amp; over from VAP. This is the most reliable adjustment to VAP and requires no additional assumptions about eligibility. However, this will somewhat overstate the true VEP because it counts ineligible felons.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vep1 =</span> vap <span class="op">-</span><span class="st"> </span>noncit)</span></code></pre></div>
</div>
<div id="vep-2" class="section level3">
<h3>VEP 2</h3>
<p>From VEP 1, VEP 2 subtracts population living in group quarters in an attempt to account for ineligible incarcerated felons. This is problematic for several reasons.</p>
<p>First, the 2016 5-year ACS tables don’t offer a breakdown of institutional &amp; non-institutional group quarters. So this would capture those with principal/permanent addresses in dormitories &amp; military barracks, among other things.</p>
<p>Second, even among the institutional population, we would capture people in nursing homes and skilled nursing facilities, which are eligible voters, even if health &amp; transportation issues prevent make voting less likely.</p>
<p>Third, the incarcerated population does not include ex-felons or those on parole or probation, the voting eligibility of whom varies by state.</p>
<p>In short, VEP 2 should probably <em>not</em> be considered a reasonably accurate estimate on its own. But we’ll calculate it anyway for comparison to other approaches, and for some consistency with estimates in other related projects, where I’ve estimated from microdata that breaks down institutional &amp; non-institutional group quarters.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vep2 =</span> vep1 <span class="op">-</span><span class="st"> </span>gquart)</span></code></pre></div>
</div>
<div id="vep-3-4" class="section level3">
<h3>VEP 3 &amp; 4</h3>
<div id="rationale" class="section level4">
<h4>Rationale</h4>
<p>To try to get a better estimate of incarcerated felons to be excluded from voting eligibility, we can possibly use county-level prison population estimates from the Vera Institute of Justice’s <a href="http://trends.vera.org/about">Incarceration Trends</a> project (data and codebook <a href="https://github.com/vera-institute/incarceration_trends">here</a>). The data includes daily average jail &amp; prison population estimates by county for 1983-2015, including pretrial jail estimates. Averaging these estimates for 2012-2015 could give a reasonable estimate of county-level incarcerated prisoners of a similar period to the 2012-2016 ACS 5-Year population estimates, with caveats.</p>
<p>First, not all those incarcerated in jail are felons and thus ineligible to vote. However, it doesn’t strike me as unreasonable to presume that incarceration presents such a barrier to voting that prisoners are generally unlikely to vote, regardless of eligibility. As such, excluding highly unlikely voters probably does not affect turnout rate estimates very much. To account for potential overestimation, <strong>VEP 3</strong> will use only the <em>prison</em> population, excluding any possible non-felons held in jail, while <strong>VEP 4</strong> will use sentenced incarcerees in jails or prisons (excluding those held in jail pre-trial).</p>
<p>Second, these estimates don’t account for non-incarcerated ineligible felons, for instance those on parole or probation. Nor do they account for disenfranchised ex-felons who have completed their sentences, which are significant in some states like Florida, Virginia, and Kentucky. Nevertheless, it seems to me that it is more appropriate to underestimate those excluded from voting eligibility than to overestimate. Not counting ineligible parolees and ex-felons also likely cancels out some of the eligible prisoner population discussed above. I am not aware of any good unrestricted public data estimating ineligible parolees or ex-felons at the county level, and using state level estimates seems inappropriate since these populations are unlikely to be equally distributed across counties.</p>
<p>Overall, VEP 3 &amp; 4 seem like a reasonable adjustments for greater accuracy than VEP 1, and certainly more accuracy than VEP 2.</p>
</div>
<div id="wrangling" class="section level4">
<h4>Wrangling</h4>
<p>The following imports the relevant incarcerated population variables from the Vera Incarceration Trends dataset for 2012-2015. We’ll calculate the <em>sentenced</em> jail population and total sentenced jail/prison. We’ll then calculate an unweighted mean estimate for each county across all four years 2012-2015, rounded to the nearest person. Missing values will be filled with 0, so that when VEP 3 &amp; 4 are calculated, VEP 3 missings will get VEP 1, and VEP 4 missings will get VEP 3.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>prisoners &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://www.dropbox.com/s/hhg9puy22b9l09q/incarceration_trends.csv?dl=1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2012</span><span class="op">:</span><span class="dv">2015</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a>    <span class="dt">fips =</span> <span class="kw">str_pad</span>(fips, <span class="dt">width =</span> <span class="dv">5</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a>    <span class="dt">prison_sentenced =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(total_prison_pop),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>                               <span class="dv">0</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>                               total_prison_pop),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>    <span class="dt">total_jail_pop =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(total_jail_pop),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a>                             <span class="dv">0</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a>                             total_jail_pop),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a>    <span class="dt">total_jail_pretrial =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(total_jail_pretrial),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a>                                  <span class="dv">0</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a>                                  total_jail_pretrial),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true"></a>    <span class="dt">jail_sentenced =</span> <span class="kw">if_else</span>((total_jail_pop <span class="op">-</span><span class="st"> </span>total_jail_pretrial) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true"></a>                             <span class="dv">0</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true"></a>                             total_jail_pop <span class="op">-</span><span class="st"> </span>total_jail_pretrial)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, prison_sentenced, jail_sentenced) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(fips) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.numeric, round)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true"></a><span class="kw">nrow</span>(prisoners)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true"></a><span class="co">## [1] 3139</span></span></code></pre></div>
<p>This yields 3,139 county estimates, as opposed to the 3,142 we got from the ACS pull. Let’s see which ones are missing/mismatched.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, state, county, poptotal) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">anti_join</span>(prisoners)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a><span class="co">##    fips state          county poptotal</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a><span class="co">## 1 36081    NY   Queens County  2310011</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a><span class="co">## 2 36005    NY    Bronx County  1436785</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a><span class="co">## 3 36047    NY    Kings County  2606852</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a><span class="co">## 4 36085    NY Richmond County   473324</span></span></code></pre></div>
<p>The Vera dataset is missing inmate info for the four non-Manhattan boroughs of New York City, suggesting that all NYC prisoners are counted in New York County (Manhattan). I don’t want to exclude these high-population counties from VEP 3 &amp; 4 estimates, so we’ll distribute the New York County prisoner estimates among all five boroughs proportional to their total population share. This might seem like a bit of a shaky assumption, but we are making best-available estimates, and we have the reliable VAP &amp; VEP 1 estimates to fall back on. An alternative would be to aggregate all the other outer borough estimates with Manhattan into one mega-county, which is something to consider for the future. But there still some interesting analyses &amp; visualizations we can do with the five boroughs separate, so we’ll go this route for now.</p>
<p>First, we’ll get the population proportions of each borough. The <code>as.data.frame()</code> calls are because <code>cnty</code> is an <code>sf</code> object, and we need to exclude the geometry data.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="co">## vector of the boroughs&#39; county names</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>nycnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;New York County&quot;</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>              <span class="st">&quot;Queens County&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>              <span class="st">&quot;Kings County&quot;</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a>              <span class="st">&quot;Bronx County&quot;</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>              <span class="st">&quot;Richmond County&quot;</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a><span class="co">## subset FIPS code &amp; county names of the boroughs from main data frame</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true"></a>nycfips &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;NY&quot;</span>, county <span class="op">%in%</span><span class="st"> </span>nycnames) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, county)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true"></a><span class="co">## convert to a named vector of the FIPS codes &amp; view to check</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true"></a>nycfips &lt;-<span class="st"> </span><span class="kw">setNames</span>(nycfips<span class="op">$</span>fips, nycfips<span class="op">$</span>county)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true"></a>nycfips</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true"></a><span class="co">##   Queens County    Bronx County    Kings County New York County Richmond County </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true"></a><span class="co">##         &quot;36081&quot;         &quot;36005&quot;         &quot;36047&quot;         &quot;36061&quot;         &quot;36085&quot;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true"></a><span class="co">## total nyc population &amp; borough proportions</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true"></a>nycpop &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">as.data.frame</span>(cnty)[<span class="kw">which</span>(cnty<span class="op">$</span>fips <span class="op">%in%</span><span class="st"> </span>nycfips), <span class="st">&quot;poptotal&quot;</span>])</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true"></a>manhattan_prop &lt;-<span class="st"> </span>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;New York County&quot;</span>]] <span class="op">/</span><span class="st"> </span>nycpop</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true"></a>brooklyn_prop &lt;-<span class="st"> </span>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Kings County&quot;</span>]] <span class="op">/</span><span class="st"> </span>nycpop</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true"></a>queens_prop &lt;-<span class="st"> </span>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Queens County&quot;</span>]] <span class="op">/</span><span class="st"> </span>nycpop</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true"></a>bronx_prop &lt;-<span class="st"> </span>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Bronx County&quot;</span>]] <span class="op">/</span><span class="st"> </span>nycpop</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true"></a>staten_prop &lt;-<span class="st"> </span>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Richmond County&quot;</span>]] <span class="op">/</span><span class="st"> </span>nycpop</span></code></pre></div>
<p>Next we’ll join the <code>prisoner</code> data to <code>cnty</code> &amp; proportionally distribute the Manhattan estimates among the five boroughs.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span><span class="kw">left_join</span>(cnty, prisoners)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a><span class="co">## totals to distribute</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a>nycpris &lt;-<span class="st">  </span>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;New York County&quot;</span>]]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a>nycjail &lt;-<span class="st"> </span>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;New York County&quot;</span>]]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a><span class="co">## distributions</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;New York County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycpris <span class="op">*</span><span class="st"> </span>manhattan_prop)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;New York County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycjail <span class="op">*</span><span class="st"> </span>manhattan_prop)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Kings County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycpris <span class="op">*</span><span class="st"> </span>brooklyn_prop)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Kings County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycjail <span class="op">*</span><span class="st"> </span>brooklyn_prop)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Queens County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycpris <span class="op">*</span><span class="st"> </span>queens_prop)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Queens County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycjail <span class="op">*</span><span class="st"> </span>queens_prop)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true"></a>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Bronx County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycpris <span class="op">*</span><span class="st"> </span>bronx_prop)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true"></a>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Bronx County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycjail <span class="op">*</span><span class="st"> </span>bronx_prop)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true"></a>cnty<span class="op">$</span>prison_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Richmond County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycpris <span class="op">*</span><span class="st"> </span>staten_prop)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true"></a>cnty<span class="op">$</span>jail_sentenced[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span>nycfips[<span class="st">&quot;Richmond County&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true"></a><span class="st">  </span><span class="kw">round</span>(nycjail <span class="op">*</span><span class="st"> </span>staten_prop)</span></code></pre></div>
<p>Finally, we’ll calculate VEP 3 &amp; 4. We’ll also check for missings, but there should be none since we converted <code>NA</code>’s in <code>prisoners</code> to 0 when we imported.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>    <span class="dt">vep3 =</span> vep1 <span class="op">-</span><span class="st"> </span>prison_sentenced,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>    <span class="dt">vep4 =</span> vep3 <span class="op">-</span><span class="st"> </span>jail_sentenced</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>  )</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(cnty<span class="op">$</span>vep3))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true"></a><span class="co">## [1] 0</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(cnty<span class="op">$</span>vep4))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true"></a><span class="co">## [1] 0</span></span></code></pre></div>
</div>
</div>
</div>
<div id="turnout" class="section level2">
<h2>Turnout</h2>
<p>We can get total votes cast per county from the <em>County Presidential Election Returns 2000-2016</em> dataset obtained from the <a href="https://electionlab.mit.edu/data">MIT Election Data Project</a> (data hosted at <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/VOQCHQ">Harvard Dataverse</a>). The dataset includes rows for per-party vote shares, but we only need total votes cast, so we filter for only one party in the 2016 election. The data are in an .RData file, which can’t be loaded remotely, so we’ll download them to a temp file first.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>temprdata &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.RData&quot;</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>dataURL &lt;-<span class="st"> &quot;https://www.dropbox.com/s/00l3gqzjx5th0ho/countypres_2000-2016.RData?dl=1&quot;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a><span class="kw">download.file</span>(dataURL, <span class="dt">destfile =</span> temprdata, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a><span class="kw">load</span>(temprdata)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a>votes &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">fips =</span> FIPS) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a>    <span class="dt">fips =</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>      <span class="kw">as.character</span>(fips) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a><span class="st">      </span><span class="kw">str_pad</span>(<span class="dt">width =</span> <span class="dv">5</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> &quot;2016&quot;</span>, party <span class="op">==</span><span class="st"> &quot;democrat&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, totalvotes)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a><span class="kw">nrow</span>(votes)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a><span class="co">## [1] 3158</span></span></code></pre></div>
<div id="mismatches-missings" class="section level3">
<h3>Mismatches &amp; Missings</h3>
<p>This data frame has 3,158 rows/FIPS codes, as opposed to the 3,142 in <code>cnty</code>. Let’s investigate:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, state, county) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">anti_join</span>(votes)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a><span class="co">##     fips state                            county</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a><span class="co">## 1  46102    SD              Oglala Lakota County</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a><span class="co">## 2  02050    AK                Bethel Census Area</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a><span class="co">## 3  02105    AK         Hoonah-Angoon Census Area</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a><span class="co">## 4  02122    AK           Kenai Peninsula Borough</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a><span class="co">## 5  02150    AK             Kodiak Island Borough</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a><span class="co">## 6  02164    AK        Lake and Peninsula Borough</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true"></a><span class="co">## 7  02180    AK                  Nome Census Area</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true"></a><span class="co">## 8  02188    AK          Northwest Arctic Borough</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true"></a><span class="co">## 9  02198    AK Prince of Wales-Hyder Census Area</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true"></a><span class="co">## 10 02261    AK        Valdez-Cordova Census Area</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true"></a><span class="co">## 11 02158    AK              Kusilvak Census Area</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true"></a><span class="co">## 12 02070    AK            Dillingham Census Area</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true"></a><span class="co">## 13 02110    AK           Juneau City and Borough</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true"></a><span class="co">## 14 02130    AK         Ketchikan Gateway Borough</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true"></a><span class="co">## 15 02185    AK               North Slope Borough</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true"></a><span class="co">## 16 02195    AK            Petersburg Census Area</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true"></a><span class="co">## 17 02220    AK            Sitka City and Borough</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true"></a><span class="co">## 18 02230    AK              Skagway Municipality</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true"></a><span class="co">## 19 02020    AK            Anchorage Municipality</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true"></a><span class="co">## 20 02068    AK                    Denali Borough</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true"></a><span class="co">## 21 02013    AK            Aleutians East Borough</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true"></a><span class="co">## 22 02275    AK         Wrangell City and Borough</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true"></a><span class="co">## 23 02240    AK   Southeast Fairbanks Census Area</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true"></a><span class="co">## 24 02090    AK      Fairbanks North Star Borough</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true"></a><span class="co">## 25 02100    AK                    Haines Borough</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true"></a><span class="co">## 26 02170    AK         Matanuska-Susitna Borough</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true"></a><span class="co">## 27 02016    AK        Aleutians West Census Area</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true"></a><span class="co">## 28 02060    AK               Bristol Bay Borough</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true"></a><span class="co">## 29 02290    AK         Yukon-Koyukuk Census Area</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true"></a><span class="co">## 30 02282    AK          Yakutat City and Borough</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true"></a><span class="co">## 31 15005    HI                    Kalawao County</span></span></code></pre></div>
<p>Mismatches are mostly from Alaska, plus Oglala Lakota County, SD and Kalawao County, HI. Let’s also check for missings in the vote totals &amp; track down any that exist.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="kw">anyNA</span>(votes<span class="op">$</span>totalvotes)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a><span class="co">## [1] TRUE</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(fips <span class="op">%in%</span><span class="st"> </span>votes<span class="op">$</span>fips[<span class="kw">is.na</span>(votes<span class="op">$</span>totalvotes)]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, county, state)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a><span class="co">##    fips           county state</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true"></a><span class="co">## 1 31103 Keya Paha County    NE</span></span></code></pre></div>
<p>Keya Paha County, NE is missing a vote total.</p>
<p>Let’s try to fix these issues if possible.</p>
<div id="keya-paha-county-ne" class="section level4">
<h4>Keya Paha County, NE</h4>
<p>Keya Paha’s 2016 vote total of <strong>653</strong> is available from the Nebraska Secretary of State’s <a href="http://www.sos.ne.gov/elec/2016/pdf/2016-canvass-book.pdf">official election returns</a> (<a href="https://web.archive.org/web/20190612013322/http://www.sos.ne.gov/elec/2016/pdf/2016-canvass-book.pdf">archive</a>).</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>votes<span class="op">$</span>totalvotes[votes<span class="op">$</span>fips <span class="op">==</span><span class="st"> &quot;31103&quot;</span>] &lt;-<span class="st"> </span><span class="dv">653</span></span></code></pre></div>
</div>
<div id="oglala-lakota-county-sd" class="section level4">
<h4>Oglala Lakota County, SD</h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a>    year <span class="op">==</span><span class="st"> &quot;2016&quot;</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a>    party <span class="op">==</span><span class="st"> &quot;democrat&quot;</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a>    state_po <span class="op">==</span><span class="st"> &quot;SD&quot;</span>, </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a>    county <span class="op">==</span><span class="st"> &quot;Oglala Lakota&quot;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(FIPS, county, state_po, totalvotes)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a><span class="co">##        FIPS        county state_po totalvotes</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a><span class="co">## 48339 46113 Oglala Lakota       SD       2905</span></span></code></pre></div>
<p>These data appear to use the pre-2015 FIPS code from when Oglala Lakota was known as Shannon County, likely for consistency with the other pre-2015 observations in the MIT dataset. Details of the change can be found <a href="https://www.cdc.gov/nchs/nvss/bridged_race/county_geography-_changes2015.pdf">here</a> (<a href="https://web.archive.org/web/20190611025302/https://www.cdc.gov/nchs/nvss/bridged_race/county_geography-_changes2015.pdf">archive</a>) Correct FIPS to 46102 to match the rest of the data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>votes<span class="op">$</span>fips[votes<span class="op">$</span>fips <span class="op">==</span><span class="st"> &quot;46113&quot;</span>] &lt;-<span class="st"> &quot;46102&quot;</span></span></code></pre></div>
</div>
<div id="kalawao-county-hi" class="section level4">
<h4>Kalawao County, HI</h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a><span class="co">## shows Kalawao is missing from MIT vote data, not just mis-coded.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a>    year <span class="op">==</span><span class="st"> &quot;2016&quot;</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a>    party <span class="op">==</span><span class="st"> &quot;democrat&quot;</span>, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a>    FIPS <span class="op">==</span><span class="st"> &quot;Kalawao County&quot;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(FIPS, county, state_po, totalvotes) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">nrow</span>()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a><span class="co">## [1] 0</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true"></a><span class="co">## shows tiny population of Kalawao</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true"></a>cnty<span class="op">$</span>poptotal[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> &quot;15005&quot;</span>]</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true"></a><span class="co">## [1] 91</span></span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Kalawao_County,_Hawaii">Kalawao County, HI</a>, is a <em>very</em> low population county, formed as a colony to sequester those with Hansen’s disease (historically called leprosy). It does not have its own government, nor administrative structures of any sort. It is administered directly by the Hawaii Department of Health.</p>
<p>Election results for kalawao don’t appear to be widely available and are missing from the MIT data, <a href="https://uselectionatlas.org/RESULTS/">Dave Leip’s Atlas of U.S. Presidential Elections</a>, and <a href="https://www.nytimes.com/elections/2016/results/hawaii">New York Times/AP Results</a>.</p>
<p>However, I was able to locate 2016 returns in the <a href="https://elections.hawaii.gov/election-results/">Hawaii Office of Elections</a> detailed precinct results. Kalawao County’s only settlement of Kalaupapa votes by mail as precinct 13-09. Page 234 of the <a href="http://files.hawaii.gov/elections/files/results/2016/general/precinct.pdf">2016 Precint Detail <strong>PDF</strong></a> (<a href="https://web.archive.org/web/20190611040103/http://files.hawaii.gov/elections/files/results/2016/general/precinct.pdf">archive</a>) shows <strong>20 votes</strong> cast for president. We’ll add these votes in when we join a little later.</p>
</div>
<div id="alaska" class="section level4">
<h4>Alaska</h4>
<p>Alaska is weird as fuck. For lots of reasons. But the weirdness pertinent here is that <a href="https://en.wikipedia.org/wiki/List_of_boroughs_and_census_areas_in_Alaska">Alaska does not have counties</a> in the sense that the other states do, as local government areas responsible directly to the state government. Instead, there are several “boroughs”, which are more or less equivalent to counties and assigned FIPS codes, and a large, discontinuous “Unorganized Borough,” which is subdivided into several “Census Areas”. Electorally, boroughs <em>do <em>not</em> align</em> to the boundaries of electoral districts, as seen in the <a href="http://www.elections.alaska.gov/Core/districtmaps.php">Alaska Division of Elections 2013 district maps maps</a> (<a href="https://web.archive.org/web/20190611133810/http://www.elections.alaska.gov/Core/districtmaps.php">archive</a>) in use in 2016. Alaska reports election results at the district level, not the borough/county-equivalent/FIPS-coded level, so other results sources like the MIT Election Lab data follow this convention.</p>
<p>All of this presents difficulty when all of our other data is at the FIPS level. Luckily, it appears that <em>precincts</em> seem to follow borough/county-equivalent boundaries, even when the broader state legislative district crosses boundaries. Republican analysis/strategy firm RRH Elections has <a href="https://rrhelections.com/index.php/2018/02/02/alaska-results-by-county-equivalent-1960-2016/">estimated FIPS-level turnout</a> (<a href="https://web.archive.org/web/20190404123624/https://rrhelections.com/index.php/2018/02/02/alaska-results-by-county-equivalent-1960-2016/">archive</a>) for presidential elections using precinct returns and proportionally allocating absentee &amp; early votes (which shouldn’t affect the total vote count, which is all we need). Frustratingly, the data are only available as grainy PNGs &amp; don’t include FIPS. To get usable data, I converted the 2016 PNG to PDF, used Acrobat Pro text recognition, exported to Excel, and manually entered the FIPS codes. And of course triple checked the results, which we’ll further verify below.</p>
<p>The below checks the manually FIPS-name pairs against the dataset imported from <code>tidycensus</code>. We do find one additional observation in <code>fips_codes</code>, but it refers to pre-2015 name/FIPS of the <a href="https://en.wikipedia.org/wiki/Kusilvak_Census_Area,_Alaska">Kusilvak Census Area</a>, similar to the renaming and recoding of Oglala Lakota, SD above.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>votes_ak &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://www.dropbox.com/s/vl21gum7enbqoao/ak2016_fips.csv?dl=1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a><span class="co">## Parsed with column specification:</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a><span class="co">## cols(</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a><span class="co">##   fips = col_character(),</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a><span class="co">##   county_equivalent = col_character(),</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a><span class="co">##   clinton = col_character(),</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a><span class="co">##   trump = col_character(),</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a><span class="co">##   johnson = col_character(),</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a><span class="co">##   est_total_votes = col_double()</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a><span class="co">## )</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true"></a>fips_ak &lt;-<span class="st"> </span>fips_codes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;AK&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, county)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true"></a><span class="co">## Wade Hampton Census Area is the pre-2015 name/FIPS of Kusilvak.</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true"></a><span class="kw">anti_join</span>(fips_ak, votes_ak)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true"></a><span class="co">##    fips                   county</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true"></a><span class="co">## 1 02270 Wade Hampton Census Area</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true"></a><span class="co">## Shows that manually coded FIPS-name pairs match</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true"></a>votes_ak <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, county_equivalent) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(fips_ak) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(.))</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true"></a><span class="co">## # A tibble: 29 x 3</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true"></a><span class="co">##    fips  county_equivalent     county                           </span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true"></a><span class="co">##    &lt;chr&gt; &lt;chr&gt;                 &lt;chr&gt;                            </span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true"></a><span class="co">##  1 02013 Aleutians East        Aleutians East Borough           </span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true"></a><span class="co">##  2 02016 Aleutians West        Aleutians West Census Area       </span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true"></a><span class="co">##  3 02020 Anchorage             Anchorage Municipality           </span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true"></a><span class="co">##  4 02050 Bethel                Bethel Census Area               </span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true"></a><span class="co">##  5 02060 Bristol Bay           Bristol Bay Borough              </span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true"></a><span class="co">##  6 02068 Denali                Denali Borough                   </span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true"></a><span class="co">##  7 02070 Dillingham            Dillingham Census Area           </span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true"></a><span class="co">##  8 02090 Fairbanks North Star  Fairbanks North Star Borough     </span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true"></a><span class="co">##  9 02100 Haines                Haines Borough                   </span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true"></a><span class="co">## 10 02105 Hoonah-Angoon         Hoonah-Angoon Census Area        </span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true"></a><span class="co">## 11 02110 Juneau                Juneau City and Borough          </span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true"></a><span class="co">## 12 02122 Kenai Peninsula       Kenai Peninsula Borough          </span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true"></a><span class="co">## 13 02130 Ketchikan Gateway     Ketchikan Gateway Borough        </span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true"></a><span class="co">## 14 02150 Kodiak Island         Kodiak Island Borough            </span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true"></a><span class="co">## 15 02164 Lake and Peninsula    Lake and Peninsula Borough       </span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true"></a><span class="co">## 16 02170 Matanuska-Sustina     Matanuska-Susitna Borough        </span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true"></a><span class="co">## 17 02180 Nome                  Nome Census Area                 </span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true"></a><span class="co">## 18 02185 North Slope           North Slope Borough              </span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true"></a><span class="co">## 19 02188 Northwest Arctic      Northwest Arctic Borough         </span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true"></a><span class="co">## 20 02195 Petersburg            Petersburg Census Area           </span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true"></a><span class="co">## 21 02198 Prince of Wales-Hyder Prince of Wales-Hyder Census Area</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true"></a><span class="co">## 22 02220 Sitka                 Sitka City and Borough           </span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true"></a><span class="co">## 23 02230 Skagway               Skagway Municipality             </span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true"></a><span class="co">## 24 02240 Southeast Fairbanks   Southeast Fairbanks Census Area  </span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true"></a><span class="co">## 25 02261 Valdez-Cordova        Valdez-Cordova Census Area       </span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true"></a><span class="co">## 26 02158 Kusilvak              Kusilvak Census Area             </span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true"></a><span class="co">## 27 02275 Wrangell              Wrangell City and Borough        </span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true"></a><span class="co">## 28 02282 Yakutat               Yakutat City and Borough         </span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true"></a><span class="co">## 29 02290 Yukon-Koyukuk         Yukon-Koyukuk Census Area</span></span></code></pre></div>
</div>
</div>
<div id="join-fill" class="section level3">
<h3>Join &amp; Fill</h3>
<p>First, we’ll subset <code>votes</code> to only the FIPS codes contained in <code>cnty</code> (recall that the miscoded FIPS for Oglala Lakota, SD has already been fixed).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>votes &lt;-<span class="st"> </span>votes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(fips <span class="op">%in%</span><span class="st"> </span>cnty<span class="op">$</span>fips)</span></code></pre></div>
<p>Then we’ll bind Alaska estimates and Kalawao County totals, getting the all-important 3,142 rows. We’ll also make sure that the FIPS match. And finally we’ll join <code>votes</code> to <code>cnty</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a><span class="co">## Attach</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>votes &lt;-<span class="st"> </span>votes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">bind_rows</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a>    votes_ak <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a><span class="st">      </span><span class="kw">select</span>(fips, est_total_votes) <span class="op">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a><span class="st">      </span><span class="kw">rename</span>( <span class="dt">totalvotes =</span> est_total_votes),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true"></a>    <span class="kw">list</span>(<span class="dt">fips =</span> <span class="st">&quot;15005&quot;</span>, <span class="dt">totalvotes =</span> <span class="dv">20</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true"></a>  )</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true"></a><span class="co">## FIPS lists match</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true"></a><span class="kw">setdiff</span>(cnty<span class="op">$</span>fips, votes<span class="op">$</span>fips)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true"></a><span class="co">## character(0)</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true"></a><span class="co">## Join</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span><span class="kw">left_join</span>(cnty, votes)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span></code></pre></div>
</div>
<div id="turnout-estimates" class="section level3">
<h3>Turnout Estimates</h3>
<p>Now that we have wrangled VAP, VEP 1-4, and total votes by county, we can <em>finally</em> calculate turnout estimates for each population estimate.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true"></a>    <span class="dt">to_vap =</span> totalvotes <span class="op">/</span><span class="st"> </span>vap,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true"></a>    <span class="dt">to_vep1 =</span> totalvotes <span class="op">/</span><span class="st"> </span>vep1,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true"></a>    <span class="dt">to_vep2 =</span> totalvotes <span class="op">/</span><span class="st"> </span>vep2,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true"></a>    <span class="dt">to_vep3 =</span> totalvotes <span class="op">/</span><span class="st"> </span>vep3,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true"></a>    <span class="dt">to_vep4 =</span> totalvotes <span class="op">/</span><span class="st"> </span>vep4</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
</div>
<div id="unemployment" class="section level2">
<h2>Unemployment</h2>
<p>We’ll get average county unemployment over the six month May-October period preceding the early November 2016 election. We’ll use <a href="https://github.com/keberwein/blscrapeR">blscrapeR package</a> again to access the BLS API.</p>
<div id="bls-api-pull" class="section level3">
<h3>BLS API Pull</h3>
<p>First, we need to get the BLS series codes for county-level unemployment. We’ll split these into chunks as before</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>blsseries &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;LAUCN&quot;</span>, allfips, <span class="st">&quot;0000000003&quot;</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true"></a>chunks_urate &lt;-<span class="st"> </span><span class="kw">split</span>(blsseries, <span class="kw">ceiling</span>(<span class="kw">seq_along</span>(blsseries)<span class="op">/</span><span class="dv">50</span>))</span></code></pre></div>
<p>We’ll reuse the <code>bls2016</code> function we wrote above on the chunks. We’ll do a little wrangling to subset just May-October &amp; summarize to get the average six-month pre-election unemployment rate.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>unemp_out &lt;-<span class="st"> </span><span class="kw">lapply</span>(chunks_urate, bls2016)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a>ur6mo &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(unemp_out) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a>    <span class="dt">fips =</span> <span class="kw">str_sub</span>(seriesID, <span class="dt">start =</span> <span class="dv">6</span>, <span class="dt">end =</span> <span class="dv">10</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a>    <span class="dt">period =</span> <span class="kw">str_sub</span>(period, <span class="dt">start =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(period <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(fips) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ur6mo =</span> <span class="kw">mean</span>(value))</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true"></a>  </span></code></pre></div>
</div>
<div id="na-fix-join" class="section level3">
<h3>NA Fix &amp; Join</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>cnty<span class="op">$</span>county[cnty<span class="op">$</span>fips <span class="op">==</span><span class="st"> </span><span class="kw">setdiff</span>(cnty<span class="op">$</span>fips, ur6mo<span class="op">$</span>fips)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a><span class="co">## [1] &quot;Kalawao County&quot;</span></span></code></pre></div>
<p>The unemployment data are missing one county: Kalawao County, HI once again. This is because the BLS routinely aggregates Kalawao into estimates for the surrounding Maui County, reporting as “Maui + Kalawao”, as seen <a href="https://web.archive.org/web/20170606235908/https://www.bls.gov/regions/west/news-release/countyemploymentandwages_hawaii.htm">here</a> and <a href="https://web.archive.org/web/20190109023506/https://www.bls.gov/cew/boxnotes.htm">here</a>. We can try to fill in with ACS 5-Year data, which includes Employment Status estimates in table <strong>S2301</strong>. ACS Subject Tables aren’t available from <code>tidycensus</code>, so we’ll use <a href="https://github.com/hrecht/censusapi">Hannah Recht’s censusapi</a> package.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a><span class="kw">library</span>(censusapi)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>kalawao_urate &lt;-<span class="st"> </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs5/subject&quot;</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a>    <span class="dt">vintage =</span> <span class="dv">2016</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a>             <span class="st">&quot;S2301_C01_001E&quot;</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true"></a>             <span class="st">&quot;S2301_C01_001M&quot;</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true"></a>             <span class="st">&quot;S2301_C02_001E&quot;</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true"></a>             <span class="st">&quot;S2301_C02_001M&quot;</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true"></a>             <span class="st">&quot;S2301_C03_001E&quot;</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true"></a>             <span class="st">&quot;S2301_C03_001M&quot;</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true"></a>             <span class="st">&quot;S2301_C04_001E&quot;</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true"></a>             <span class="st">&quot;S2301_C04_001M&quot;</span>),</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true"></a>    <span class="dt">region =</span> <span class="st">&quot;county:005&quot;</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:15&quot;</span>,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true"></a>    <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;CENSUS_KEY&quot;</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true"></a>    <span class="dt">name =</span> NAME,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true"></a>    <span class="dt">pop =</span> S2301_C01_001E,</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true"></a>    <span class="dt">pop_moe =</span> S2301_C01_001M,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true"></a>    <span class="dt">lfpr =</span> S2301_C02_001E,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true"></a>    <span class="dt">lfpr_moe =</span> S2301_C02_001M,</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true"></a>    <span class="dt">epop =</span> S2301_C03_001E,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true"></a>    <span class="dt">epop_moe =</span> S2301_C03_001M,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true"></a>    <span class="dt">urate =</span> S2301_C04_001E,</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true"></a>    <span class="dt">urate_moe =</span> S2301_C04_001M,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fips =</span> <span class="kw">paste0</span>(state, county)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">11</span>))</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true"></a>kalawao_urate</span></code></pre></div>
<p>We can see the unemployment rate estimate is 0% ± 30.7%, which doesn’t seem very helpful. But according to <a href="https://www.theatlantic.com/health/archive/2015/05/when-the-last-patient-dies/394163/">a 2015 Atlantic article</a>, 16 of the residents were older original inmates at that time, and probably not in the labor force, while the rest appear to be healthcare or preservation workers. These figures roughly match the implied labor force from the LFPR estimate. That is, .84 × 90 = 75.6 and 90 − 16 = 74, so the labor force estimate roughly matches the article’s figures on the non-inmate population of Kalawao, whom the article implies are all government/institutional workers of some sort.</p>
<p>Based on this information, I believe the 0% unemployment figure is actually accurate. We’ll join the unemployment data and fill 0% unemployment for Kalawao County.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span><span class="kw">left_join</span>(cnty, ur6mo)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a>cnty<span class="op">$</span>ur6mo[cnty<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Kalawao County&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="hdi" class="section level2">
<h2>HDI</h2>
<p>The Measure of America project offers a <a href="http://measureofamerica.org/human-development/">modified version</a> of the UN’s Human Development Index based on data from various US statistical &amp; scientific agencies. The main differences of the <a href="https://mk0moaorgidkh7gsb4pe.kinstacdn.com/wp-content/uploads/2009/05/measureofamerica_methodology.pdf">“American HDI” methodolodgy</a> (<a href="https://web.archive.org/web/20190616184126/https://mk0moaorgidkh7gsb4pe.kinstacdn.com/wp-content/uploads/2009/05/measureofamerica_methodology.pdf">archive</a>) from the <a href="hdr.undp.org/sites/default/files/hdr2018_technical_notes.pdf">UN methodology</a> (<a href="https://web.archive.org/web/20190508051314/http://hdr.undp.org/sites/default/files/hdr2018_technical_notes.pdf">archive</a>) are:</p>
<ul>
<li><p>The Education Index is composed of different sub-indices, as opposed to the UN’s equally-weighted mean years of schooling and expected years of schooling. They are:</p>
<ul>
<li><p>An Enrollment Index, composed of the school enrollment proportion for ages 3-24, weighted at 1/3.</p></li>
<li><p>An Attainment Index, composed of the the sum of the proportions of with a high school diploma or greater, a Bachelor’s degree or greater, and a graduate or professional degree, each for ages 25 &amp; over, weighted at 2/3.</p></li>
</ul></li>
<li><p>Median personal earnings is used place of per-capita GDP in the Income Index.</p></li>
<li><p>The final composite Human Development Index is composed of an unweighted arithmetic mean of the Health, Education, and Income sub-indices, in accordance with pre-2010 UN methodology. Current UN methodology uses a <em>geometric</em> mean, so that <a href="http://hdr.undp.org/en/faq-page/human-development-index-hdi#t292n2880">proportional changes in any individual sub-index are equally reflected in the composite index</a> (<a href="https://web.archive.org/web/20190508051318/http://www.hdr.undp.org/en/faq-page/human-development-index-hdi#t292n2880">archive</a>).</p></li>
</ul>
<p>The most recent American HDI (AHDI) data available are estimates for 2010. Therefore, we’ll construct our own modified HDI (mHDI) for 2016. We’ll largely follow the Measure of America methodology, but we’ll use a geometric mean on the composite index and make a few tweaks based on public data availability.</p>
<p>The Education and Income indices are computable from the ACS 5-Year variables we’ve already retrieved, following the AHDI methodology very closely. The Health Index is not, and it presents a few data challenges, so we’ll start with it.</p>
<div id="health-index" class="section level3">
<h3>Health Index</h3>
<p>The AHDI methodology follows the UN in using life expectancy at birth (LEB) for the health index. To the best of my knowledge, there are no publicly-available county-level estimates of LEB for 2016. We could in theory construct full life tables to determine LEB from <a href="https://wonder.cdc.gov/cmf-icd10.html">CDC WONDER Compressed Mortality Files</a>, by County and by age group. However, privacy suppressions in the public-use data would yield a large number of missing values.</p>
<div id="life-expectancy-proxy" class="section level4">
<h4>Life Expectancy Proxy</h4>
<p>Instead of LEB, I propose to use county-level age-adjusted mortality rates (AAMR), also available from CDC WONDER. Since the additional granularity of deaths by age group is not reported in these figures, there are fewer privacy suppressions, and thus less missing data in the end result, than constructing life tables would get us.</p>
<p>First, we need to determine if AAMR is a reasonable proxy for LEB. The Robert Wood Johnson Foundation’s <a href="https://www.countyhealthrankings.org/explore-health-rankings/rankings-data-documentation">2019 County Health Rankings Data</a> includes both LEB and AAMR data, so we can check the correlation between the two measures. (Note: the <code>data.frame()</code> call at the end of the pipeline is to get rid of all the annoying column specification attributes added by <code>read_csv()</code>.)</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>rwjf &lt;-</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">read_csv</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a>    <span class="st">&quot;https://www.dropbox.com/s/0wtoms2ih6vmmyd/analytic_data2019_0.csv?dl=1&quot;</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a>    <span class="dt">skip =</span> <span class="dv">1</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(countycode <span class="op">!=</span><span class="st"> &quot;000&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fipscode, v147_rawvalue, v127_rawvalue) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true"></a>    <span class="dt">fips =</span> fipscode,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true"></a>    <span class="dt">leb =</span> v147_rawvalue,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true"></a>    <span class="dt">aamr =</span> v127_rawvalue</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">data.frame</span>()</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true"></a><span class="kw">cor</span>(rwjf<span class="op">$</span>leb, rwjf<span class="op">$</span>aamr, <span class="dt">use =</span> <span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true"></a><span class="co">## [1] -0.9483273</span></span></code></pre></div>
<p>There is a very strong negative correlation between AAMR and LEB — strong enough that it age-adjusted mortality clearly makes a good proxy for life expectancy.</p>
<p>The RWJF data cover 2015-2017, so we’ll get the 2016 estimates from the <a href="https://wonder.cdc.gov/cmf-icd10.html">CDC WONDER Compressed Mortality Files</a>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>mort &lt;-<span class="st"> </span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">read_delim</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true"></a>    <span class="st">&quot;https://www.dropbox.com/s/lx1d819yo8hi8g2/Compressed_Mortality_county_2016.txt?dl=1&quot;</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true"></a>    <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true"></a>    <span class="dt">skip =</span> <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true"></a>    <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">&quot;notes&quot;</span>, <span class="st">&quot;county&quot;</span>, <span class="st">&quot;fips&quot;</span>, <span class="st">&quot;deaths&quot;</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true"></a>                  <span class="st">&quot;population&quot;</span>, <span class="st">&quot;crude&quot;</span>, <span class="st">&quot;aamr&quot;</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true"></a>    <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;Suppressed&quot;</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(fips <span class="op">%in%</span><span class="st"> </span>cnty<span class="op">$</span>fips) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, aamr)</span></code></pre></div>
<p>Some of the values with wide margins of error have a text flag “(Unreliable)” on the end of the AAMR estimate, forcing the variable into <code>character()</code> class. We’ll use <code>gsub</code> to subset only numerals and decimal points and convert to numeric.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>mort &lt;-<span class="st"> </span>mort <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">aamr =</span> <span class="kw">gsub</span>(<span class="st">&quot;[^0-9.]&quot;</span>, <span class="st">&quot;&quot;</span>, mort<span class="op">$</span>aamr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>())</span></code></pre></div>
</div>
<div id="mortality-imputation" class="section level4">
<h4>Mortality Imputation</h4>
<p>We have several missing AAMR estimates, mostly from low-population counties:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>mort_missing &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, county, state, poptotal) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">anti_join</span>(<span class="kw">na.omit</span>(mort))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true"></a>mort_missing</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true"></a><span class="co">##     fips                   county state poptotal</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true"></a><span class="co">## 1  08053          Hinsdale County    CO      856</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true"></a><span class="co">## 2  08111          San Juan County    CO      552</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true"></a><span class="co">## 3  31171            Thomas County    NE      675</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true"></a><span class="co">## 4  31183           Wheeler County    NE      805</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true"></a><span class="co">## 5  30069         Petroleum County    MT      445</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true"></a><span class="co">## 6  31009            Blaine County    NE      580</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true"></a><span class="co">## 7  31085             Hayes County    NE     1013</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true"></a><span class="co">## 8  31117         McPherson County    NE      425</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true"></a><span class="co">## 9  38007          Billings County    ND      936</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true"></a><span class="co">## 10 48393           Roberts County    TX      939</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true"></a><span class="co">## 11 48433         Stonewall County    TX     1233</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true"></a><span class="co">## 12 48263              Kent County    TX      667</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true"></a><span class="co">## 13 16025             Camas County    ID      968</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true"></a><span class="co">## 14 16033             Clark County    ID      960</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true"></a><span class="co">## 15 31007            Banner County    NE      793</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true"></a><span class="co">## 16 31075             Grant County    NE      647</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true"></a><span class="co">## 17 35021           Harding County    NM      565</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true"></a><span class="co">## 18 31115              Loup County    NE      542</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true"></a><span class="co">## 19 48033            Borden County    TX      698</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true"></a><span class="co">## 20 46063           Harding County    SD     1277</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true"></a><span class="co">## 21 46075             Jones County    SD      767</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true"></a><span class="co">## 22 46102     Oglala Lakota County    SD    14263</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true"></a><span class="co">## 23 48301            Loving County    TX       76</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true"></a><span class="co">## 24 38087             Slope County    ND      665</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true"></a><span class="co">## 25 46119             Sully County    SD     1456</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true"></a><span class="co">## 26 31005            Arthur County    NE      437</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true"></a><span class="co">## 27 48173         Glasscock County    TX     1253</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true"></a><span class="co">## 28 48269              King County    TX      274</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true"></a><span class="co">## 29 28055         Issaquena County    MS     1352</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true"></a><span class="co">## 30 30103          Treasure County    MT      846</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true"></a><span class="co">## 31 31103         Keya Paha County    NE      736</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true"></a><span class="co">## 32 48311          McMullen County    TX      671</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true"></a><span class="co">## 33 48261            Kenedy County    TX      558</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true"></a><span class="co">## 34 31113             Logan County    NE      830</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true"></a><span class="co">## 35 02158     Kusilvak Census Area    AK     7993</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true"></a><span class="co">## 36 02230     Skagway Municipality    AK     1014</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true"></a><span class="co">## 37 02060      Bristol Bay Borough    AK      942</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true"></a><span class="co">## 38 02282 Yakutat City and Borough    AK      646</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true"></a><span class="co">## 39 15005           Kalawao County    HI       91</span></span></code></pre></div>
<p>The very high correlation between LEB &amp; AAMR suggests that we may be able to impute these values with modeled AAMR estimates based on the at least roughly contemporary 2010 LEB estimates from the <a href="http://www.healthdata.org/us-health/data-download">Institute for Health Metrics and Evaluation</a> (<a href="https://web.archive.org/web/20190423102357/http://www.healthdata.org/us-health/data-download">archive</a>).</p>
<p>First, let’s visualize the appropriateness of various simple models based on on the RWJF data.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a><span class="kw">na.omit</span>(rwjf) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> leb, <span class="dt">y =</span> aamr)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true"></a>    <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;LOESS&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;LOESS&quot;</span>),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Linear&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true"></a>    <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>splines<span class="op">::</span><span class="kw">bs</span>(x, <span class="dt">degree =</span> <span class="dv">2</span>),</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Quadratic&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Quadratic&quot;</span>),</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;steelblue2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>),</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true"></a>                     <span class="dt">name =</span> <span class="st">&quot;Model&quot;</span>) <span class="op">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;steelblue2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>),</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true"></a>                    <span class="dt">name =</span> <span class="st">&quot;Model&quot;</span>) <span class="op">+</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true"></a><span class="co">## `geom_smooth()` using formula &#39;y ~ x&#39;</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true"></a><span class="co">## `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="assets/img/mort%20model%20plot-1.png" width="672" /></p>
<p>All models closely align at the dense center of the data, but the the quadratic model performs much better at the extremes relative to the LOESS fit than does the linear model. Therefore, I believe that we should model AAMR as a quadratic function of LEB to impute the missing counties’ values.</p>
<p>Let’s go ahead and run the regression.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a>rwjf<span class="op">$</span>lebsq &lt;-<span class="st"> </span>rwjf<span class="op">$</span>leb<span class="op">^</span><span class="dv">2</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a>mort_model &lt;-<span class="st"> </span><span class="kw">lm</span>(aamr <span class="op">~</span><span class="st"> </span>leb <span class="op">+</span><span class="st"> </span>lebsq, <span class="dt">data =</span> <span class="kw">na.omit</span>(rwjf))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true"></a><span class="kw">summary</span>(mort_model)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true"></a><span class="co">## Call:</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true"></a><span class="co">## lm(formula = aamr ~ leb + lebsq, data = na.omit(rwjf))</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true"></a><span class="co">## Residuals:</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true"></a><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true"></a><span class="co">## -214.31  -15.47   -2.05   12.67  223.28 </span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true"></a><span class="co">## Coefficients:</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true"></a><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true"></a><span class="co">## (Intercept) 10772.3622   164.2617   65.58   &lt;2e-16 ***</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true"></a><span class="co">## leb          -231.5823     4.2272  -54.78   &lt;2e-16 ***</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true"></a><span class="co">## lebsq           1.2599     0.0272   46.32   &lt;2e-16 ***</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true"></a><span class="co">## ---</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true"></a><span class="co">## Residual standard error: 27.39 on 3058 degrees of freedom</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true"></a><span class="co">## Multiple R-squared:  0.9408, Adjusted R-squared:  0.9408 </span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true"></a><span class="co">## F-statistic: 2.432e+04 on 2 and 3058 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Very strong fit &amp; small standard errors, as we would expect from the plot. I feel quite comfortable about using this model for imputation.</p>
<p>Next, let’s import the IHME 2010 Life Expectancy estimates. They are in an Excel sheet, so we’ll need <code>readxl</code>. And since <code>readxl</code> can’t read directly from a URL, we need download the workbook as a temp file first. The estimates separate male and female life expectancy, so based on the approximate 50-50 sex split in most areas, we’ll take a simple unweighted average to get a single estimate.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a><span class="kw">library</span>(readxl)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a>tempxl &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.xlsx&quot;</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a>dataURL &lt;-<span class="st"> &quot;https://www.dropbox.com/s/18tjlmaxzr54x9e/IHME_county_data_LifeExpectancy_Obesity_PhysicalActivity_NATIONAL.xlsx?dl=1&quot;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a><span class="kw">download.file</span>(dataURL, <span class="dt">destfile =</span> tempxl, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a>ihme &lt;-<span class="st"> </span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">read_excel</span>(tempxl, <span class="dt">sheet =</span> <span class="st">&quot;Life Expectancy&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(County)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">13</span><span class="op">:</span><span class="dv">14</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true"></a><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;county&quot;</span>, <span class="st">&quot;male2010&quot;</span>, <span class="st">&quot;female2010&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">leb =</span> (male2010 <span class="op">+</span><span class="st"> </span>female2010) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(state, county, leb)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true"></a><span class="kw">sample_n</span>(ihme, <span class="dv">10</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true"></a><span class="co">## # A tibble: 10 x 3</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true"></a><span class="co">##    state       county       leb</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true"></a><span class="co">##    &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true"></a><span class="co">##  1 Nebraska    Richardson  78  </span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true"></a><span class="co">##  2 Iowa        Jasper      78.4</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true"></a><span class="co">##  3 Wisconsin   Milwaukee   76.9</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true"></a><span class="co">##  4 Missouri    Saline      77.2</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true"></a><span class="co">##  5 Tennessee   Dyer        75.1</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true"></a><span class="co">##  6 Nebraska    Hall        78.5</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true"></a><span class="co">##  7 Mississippi Jefferson   72.8</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true"></a><span class="co">##  8 Ohio        Morgan      76.9</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true"></a><span class="co">##  9 Louisiana   Ouachita    74.8</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true"></a><span class="co">## 10 Missouri    Greene      77.2</span></span></code></pre></div>
<p>The IMHE data frustratingly don’t include FIPS codes. We’ll try to get them by joining by county names extracted from our main <code>cnty</code> dataset. However, the IHME county names also lack the words “County,” “Parish,” etc., so we’ll also strip those from the extract from <code>cnty</code>. Then we’ll see if we can correct any remaining mismatches</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>csub &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, county, state_name) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_remove</span>(county, <span class="st">&quot; County&quot;</span>),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_remove</span>(county, <span class="st">&quot; Parish&quot;</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_remove</span>(county, <span class="st">&quot; Borough&quot;</span>),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_remove</span>(county, <span class="st">&quot; Census Area&quot;</span>),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_remove</span>(county, <span class="st">&quot; Municipality&quot;</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true"></a>    <span class="dt">county =</span> <span class="kw">str_replace</span>(county, <span class="st">&quot;city&quot;</span>, <span class="st">&quot;City&quot;</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> state_name)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true"></a><span class="kw">anti_join</span>(ihme, csub)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true"></a><span class="co">## Joining, by = c(&quot;state&quot;, &quot;county&quot;)</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true"></a><span class="co">## # A tibble: 11 x 3</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true"></a><span class="co">##    state        county                                          leb</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true"></a><span class="co">##    &lt;chr&gt;        &lt;chr&gt;                                         &lt;dbl&gt;</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true"></a><span class="co">##  1 Alaska       Wade Hampton                                   77.9</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true"></a><span class="co">##  2 Illinois     La Salle                                       77.4</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true"></a><span class="co">##  3 Iowa         OBrien                                         79.0</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true"></a><span class="co">##  4 Maryland     Prince Georges                                 77.3</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true"></a><span class="co">##  5 Maryland     Queen Annes                                    79.7</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true"></a><span class="co">##  6 Maryland     St. Marys                                      78.3</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true"></a><span class="co">##  7 Missouri     St. Genevieve                                  78.1</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true"></a><span class="co">##  8 Montana      Gallatin County and Yellowstone National Park  80.4</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true"></a><span class="co">##  9 South Dakota Shannon                                        73.6</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true"></a><span class="co">## 10 Virginia     Bedford City                                   78.1</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true"></a><span class="co">## 11 Virginia     Halifax County with South Boston City          75.2</span></span></code></pre></div>
<p>We already know that Wade Hampton, AK and Shannon, SD are the former names of Kusilvak, AK and Oglala Lakota, SD. Most of the others appear to be typos (e.g. OBrien &amp; Annes instead of O’Brien &amp; Anne’s), or additional descriptions (e.g. …and Yellowstone… rather than just Gallatin). <a href="https://en.wikipedia.org/wiki/LaSalle_County,_Illinois">LaSalle, IL</a> is spelt without a space. Finally, <a href="https://en.wikipedia.org/wiki/Bedford,_Virginia">Bedford City, VA</a> reverted from independent city status to town status &amp; rejoined surrounding Bedford County in 2013. We’ll have to manually correct all of these &amp; make sure we got everything:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>state <span class="op">==</span><span class="st"> &quot;South Dakota&quot;</span> <span class="op">&amp;</span><span class="st"> </span>ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Shannon&quot;</span>] &lt;-<span class="st"> &quot;Oglala Lakota&quot;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Wade Hampton&quot;</span>] &lt;-<span class="st"> &quot;Kusilvak&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>state <span class="op">==</span><span class="st"> &quot;Illinois&quot;</span> <span class="op">&amp;</span><span class="st"> </span>ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;La Salle&quot;</span>] &lt;-<span class="st"> &quot;LaSalle&quot;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Prince Georges&quot;</span>] &lt;-<span class="st"> &quot;Prince George&#39;s&quot;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Queen Annes&quot;</span>] &lt;-<span class="st"> &quot;Queen Anne&#39;s&quot;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;St. Marys&quot;</span>] &lt;-<span class="st"> &quot;St. Mary&#39;s&quot;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;OBrien&quot;</span>] &lt;-<span class="st"> &quot;O&#39;Brien&quot;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;St. Genevieve&quot;</span>] &lt;-<span class="st"> &quot;Ste. Genevieve&quot;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Gallatin County and Yellowstone National Park&quot;</span>] &lt;-<span class="st"> &quot;Gallatin&quot;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true"></a>ihme<span class="op">$</span>county[ihme<span class="op">$</span>county <span class="op">==</span><span class="st"> &quot;Halifax County with South Boston City&quot;</span>] &lt;-<span class="st"> &quot;Halifax&quot;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true"></a>ihme &lt;-<span class="st"> </span><span class="kw">filter</span>(ihme, county <span class="op">!=</span><span class="st"> &quot;Bedford City&quot;</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true"></a><span class="kw">setdiff</span>(ihme<span class="op">$</span>county, csub<span class="op">$</span>county)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true"></a><span class="co">## character(0)</span></span></code></pre></div>
<p>Now we can join in FIPS codes the the IHME data and join those that match to the <code>mort_missing</code> data frame.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a>ihme &lt;-<span class="st"> </span>ihme <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(csub) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, leb)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a><span class="co">## Joining, by = c(&quot;state&quot;, &quot;county&quot;)</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a>mort_missing &lt;-<span class="st"> </span>mort_missing <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(ihme) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, leb)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span></code></pre></div>
<p>Now we’ll add a LEB<sup>2</sup> variable to <code>mort_missing</code> &amp; use that data to generate AAMR predictions from the quadratic model we ran above. We’ll bind those imputed figures to our main AAMR data data from the CDC and check to make sure everything matches <code>cnty</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a><span class="co"># generate squared LEB for prediction</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a>mort_missing<span class="op">$</span>lebsq &lt;-<span class="st"> </span>mort_missing<span class="op">$</span>leb<span class="op">^</span><span class="dv">2</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true"></a><span class="co"># predict &amp; attach predictions</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true"></a>mort_missing<span class="op">$</span>aamr &lt;-<span class="st"> </span><span class="kw">predict</span>(mort_model, <span class="dt">newdata =</span> mort_missing)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true"></a><span class="co"># get just the </span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true"></a>mort_missing &lt;-<span class="st"> </span>mort_missing <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fips, aamr)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true"></a><span class="co"># drop the missing rows from the main dataframe, then add the imputations back</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true"></a>mort &lt;-<span class="st"> </span><span class="kw">na.omit</span>(mort)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true"></a>mort &lt;-<span class="st"> </span>mort <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>(mort_missing)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true"></a><span class="co"># check to make sure we have an AAMR value for each county</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true"></a><span class="kw">setdiff</span>(cnty<span class="op">$</span>fips, mort<span class="op">$</span>fips)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true"></a><span class="co">## character(0)</span></span></code></pre></div>
<p>Now we have a complete set of AAMR estimates, including the 39 imputed values. However, remember that age-adjusted mortality is <em>negatively</em> correlated with life expectancy. Death is generally negatively correlated with life, after all! So AAMR represents a “<strong>less</strong> is better” measure. HDI — and thus its sub-indices — is a more is better measure. So we’ll take the reciprocal of AAMR &amp; scale it up to get a more manageable range without a bunch of scientific notation.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>mort<span class="op">$</span>raamr &lt;-<span class="st"> </span><span class="dv">100000</span> <span class="op">/</span><span class="st"> </span>mort<span class="op">$</span>aamr</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true"></a><span class="kw">range</span>(mort<span class="op">$</span>raamr)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true"></a><span class="co">## [1]  47.14757 446.82752</span></span></code></pre></div>
<p>And finally join to <code>cnty</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span><span class="kw">left_join</span>(cnty, mort)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true"></a><span class="co">## Joining, by = &quot;fips&quot;</span></span></code></pre></div>
</div>
<div id="create-index" class="section level4">
<h4>Create Index</h4>
<p>Since we’re using age-adjusted mortality as a substitute/proxy for life expectancy, we can’t use Measure of America’s goalposts directly and will need to construct our own. Following from the MoA methodology, we want to set the goalposts such that the max-min normalized index has a median close-ish to 5. We also need a non-zero minimum since we’ll ultimately be using a geometric mean &amp; don’t want to multiply by zero. Let’s start with some quantiles to help guide us.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>raamr, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a><span class="co">##   0%  10%  20%  30%  40%  50%  60%  70%  80%  90% 100% </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true"></a><span class="co">##   47   97  105  112  118  124  130  137  146  162  447</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>raamr, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="fl">0.9</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>()</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true"></a><span class="co">##  90%  91%  92%  93%  94%  95%  96%  97%  98%  99% 100% </span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true"></a><span class="co">##  162  164  167  170  174  178  185  195  215  267  447</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>raamr, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="fl">0.99</span>, <span class="dv">1</span>, <span class="fl">0.0025</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>()</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true"></a><span class="co">##    99% 99.25%  99.5% 99.75%   100% </span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true"></a><span class="co">##    267    281    302    316    447</span></span></code></pre></div>
<p>There seem to be quite a few extreme upper outliers, indicating a pretty hefty left skew, which we’ll confirm with a quick, ugly density plot.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a><span class="kw">density</span>(cnty<span class="op">$</span>raamr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="assets/img/mort%20density-1.png" width="672" /></p>
<p>Yep! So let’s log-transform the reciprocal age-adjusted mortality rates, which is quite the mouthful, and check the quantiles and density plot on that.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>cnty<span class="op">$</span>lraamr &lt;-<span class="st"> </span><span class="kw">log</span>(cnty<span class="op">$</span>raamr)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>lraamr, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a><span class="co">##   0%  10%  20%  30%  40%  50%  60%  70%  80%  90% 100% </span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a><span class="co">## 3.85 4.58 4.66 4.72 4.77 4.82 4.87 4.92 4.98 5.09 6.10</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true"></a><span class="kw">density</span>(cnty<span class="op">$</span>lraamr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="assets/img/mort%20log-1.png" width="672" /></p>
<p>Much better. Let’s set our goalposts a little outside the max &amp; min &amp; <strong><em>FINALLY</em></strong> construct the actual index.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>healthmin &lt;-<span class="st"> </span><span class="fl">3.5</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true"></a>healthmax &lt;-<span class="st"> </span><span class="fl">6.25</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true"></a>    <span class="dt">health_index =</span> (lraamr <span class="op">-</span><span class="st"> </span>healthmin) <span class="op">/</span><span class="st"> </span>(healthmax <span class="op">-</span><span class="st"> </span>healthmin) <span class="op">*</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true"></a>  )</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>health_index)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true"></a><span class="co">##   1.285   4.324   4.800   4.840   5.268   9.462</span></span></code></pre></div>
<p>These goalposts achieve a median slightly below our target of 5. Let’s roll with it &amp; move on.</p>
</div>
</div>
<div id="education-index" class="section level3">
<h3>Education Index</h3>
<div id="enrollment-index" class="section level4">
<h4>Enrollment Index</h4>
<p>Here, we can follow the MoA methodology quite closely. First, we construct a gross enrollment ratio (GER) for the prime school ages of 3 to 24 from GER<sub><em>i</em></sub> = enrolled<sub><em>i</em></sub> / pop_324<sub><em>i</em></sub>. This is a little bit of a blunt instrument, because the enrollment variable is for the population <em>3 and <strong>over</strong></em>, not 3 to 24. But without microdata for every single county, these are the best public-use figures available. As in the MoA methodology, we’ll topcode GER at 1, since over-age enrollment (like yours truly!) can push some counties above 100%.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true"></a>    <span class="dt">ger =</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true"></a>      <span class="kw">if_else</span>(</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true"></a>        enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true"></a>        enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true"></a>        <span class="dv">1</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true"></a>      )</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true"></a>  )</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>ger, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true"></a><span class="co">##    0%   10%   20%   30%   40%   50%   60%   70%   80%   90%  100% </span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true"></a><span class="co">## 0.451 0.758 0.784 0.801 0.816 0.830 0.845 0.860 0.879 0.908 1.000</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>ger, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true"></a><span class="co">##    0%    1%    2%    3%    4%    5%    6%    7%    8%    9%   10% </span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true"></a><span class="co">## 0.451 0.659 0.692 0.708 0.721 0.731 0.738 0.744 0.749 0.753 0.758</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>ger, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.01</span>, <span class="fl">0.0025</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true"></a><span class="co">##    0% 0.25%  0.5% 0.75%    1% </span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true"></a><span class="co">## 0.451 0.601 0.628 0.648 0.659</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true"></a><span class="kw">density</span>(cnty<span class="op">$</span>ger) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="assets/img/enrollment%20check-1.png" width="672" /></p>
<p>The MoA minimum goalpost is 0.6, and we can see we have a few counties in the bottom 0.25% that fall below that threshold. The goalposts were set using state-level aggregates, which wouldn’t necessarily be all that responsive to a few lower outliers. The density plot looks pretty symmetric (with the right tail truncated because of the topcoding). We’ll try bottom-coding just barely above the MoA goalpost at .601 so we don’t get any index values below 0.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true"></a>    <span class="dt">ger =</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true"></a>      <span class="kw">if_else</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true"></a>        enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">.601</span> <span class="op">&amp;</span><span class="st"> </span>enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true"></a>        enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true"></a>        <span class="kw">if_else</span>(</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true"></a>          enrolled <span class="op">/</span><span class="st"> </span>pop_<span class="dv">324</span> <span class="op">&lt;</span><span class="st"> </span><span class="fl">.601</span>,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true"></a>          <span class="fl">.601</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true"></a>          <span class="dv">1</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true"></a>        )</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true"></a>      )</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true"></a>  )</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true"></a>enrollmin &lt;-<span class="st"> </span><span class="fl">.6</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true"></a>enrollmax &lt;-<span class="st"> </span><span class="fl">.95</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true"></a></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true"></a>    <span class="dt">enroll_index =</span> (ger <span class="op">-</span><span class="st"> </span>enrollmin) <span class="op">/</span><span class="st"> </span>(enrollmax <span class="op">-</span><span class="st"> </span>enrollmin) <span class="op">*</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true"></a>  )</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>enroll_index)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true"></a><span class="co">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true"></a><span class="co">##  0.02857  5.50275  6.57702  6.58480  7.72257 11.42857</span></span></code></pre></div>
<p>We won’t concern ourselves with the median and range just yet. What matters more is the overall Education Index, and Enrollment is weighted less than Attainment in the composite index.</p>
</div>
<div id="attainment-index" class="section level4">
<h4>Attainment Index</h4>
<p>Here we’ll replicate MoA methodology and goalposts exactly.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>attainmin &lt;-<span class="st"> </span><span class="fl">.5</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a>attainmax &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a>    <span class="dt">hs_prop =</span> (hsetc <span class="op">+</span><span class="st"> </span>bacc <span class="op">+</span><span class="st"> </span>grad) <span class="op">/</span><span class="st"> </span>pop_25plus,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a>    <span class="dt">bacc_prop =</span> (bacc <span class="op">+</span><span class="st"> </span>grad) <span class="op">/</span><span class="st"> </span>pop_25plus,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a>    <span class="dt">grad_prop =</span> grad <span class="op">/</span><span class="st"> </span>pop_25plus,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a>    <span class="dt">attain_score =</span> hs_prop <span class="op">+</span><span class="st"> </span>bacc_prop <span class="op">+</span><span class="st"> </span>grad_prop,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a>    <span class="dt">attain_index =</span> (attain_score <span class="op">-</span><span class="st"> </span>attainmin) <span class="op">/</span><span class="st"> </span>(attainmax <span class="op">-</span><span class="st"> </span>attainmin) <span class="op">*</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a>  )</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>attain_index)</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true"></a><span class="co">##  0.7048  3.4440  4.1272  4.2552  4.8458 11.3979</span></span></code></pre></div>
</div>
<div id="composite-education-index" class="section level4">
<h4>Composite Education Index</h4>
<p>And finally, we’ll construct the Education Index weighted average of the two sub-indices.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">educ_index =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)<span class="op">*</span>enroll_index <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)<span class="op">*</span>attain_index)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>educ_index)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a><span class="co">##  0.8444  4.2069  4.9000  5.0317  5.6899 11.4082</span></span></code></pre></div>
<p>We achieve a median close to our target of 5. We likely have a bit of right skew, with a min near 1 and a max over 11, but we’re not going to lose any sleep over it.</p>
</div>
</div>
<div id="income-index" class="section level3">
<h3>Income Index</h3>
<p>Here, we’ll use the MoA methodology, constructing a scaled index of log median personal earnings. But let’s first investigate the distribution.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>medearn)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true"></a><span class="co">##    5223   25133   27270   28174   30799   65122</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true"></a><span class="kw">quantile</span>(cnty<span class="op">$</span>medearn, <span class="kw">seq</span>(<span class="dv">0</span>,.<span class="dv">01</span>,.<span class="dv">0025</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>()</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true"></a><span class="co">##    0% 0.25%  0.5% 0.75%    1% </span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true"></a><span class="co">##  5223 13557 16309 16738 17334</span></span></code></pre></div>
<p>The MoA 2016 lower goalpost was $16,009, inflation adjusted from their initial 2005 goalpost. Once again, that figure was based on state-level aggregate ACS data, and we have a few lower outlier counties in the bottom 0.5%. Here, we’ll bottom-code at the 0.25th percentile of $13,557 and move the lower goalpost to a little below that at $12,000. We’ll leave the upper goalpost at the MoA’s $67,730.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true"></a>earnmin &lt;-<span class="st"> </span><span class="dv">12000</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true"></a>earnmax &lt;-<span class="st"> </span><span class="dv">67730</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true"></a>    <span class="dt">medearn_bc =</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true"></a>      <span class="kw">if_else</span>(</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true"></a>        medearn <span class="op">&gt;</span><span class="st"> </span><span class="kw">quantile</span>(medearn, <span class="fl">.0025</span>),</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true"></a>        medearn,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true"></a>        <span class="kw">quantile</span>(medearn, <span class="fl">.0025</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true"></a>      ),</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true"></a>    <span class="dt">inc_index =</span> </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true"></a>      (<span class="kw">log</span>(medearn_bc) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(earnmin)) <span class="op">/</span><span class="st"> </span>(<span class="kw">log</span>(earnmax) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(earnmin)) <span class="op">*</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true"></a>  )</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>inc_index)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true"></a><span class="co">##   0.705   4.272   4.743   4.839   5.446   9.773</span></span></code></pre></div>
</div>
<div id="composite-hd-index" class="section level3">
<h3>Composite HD Index</h3>
<p>Now that we have our three sub-indices, we can construct our overall Modified HDI from their geometric mean. But first, let’s take a look at their individual distributions. Remember, we’re looking for roughly balanced distributions with medians in the neighborhood of 5.</p>
<p>Boxplots:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a>hdicomps &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cnty) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(fips, health_index, educ_index, inc_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(health_index, educ_index, inc_index, <span class="dt">key =</span> <span class="st">&quot;component&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(fips)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true"></a>hdicomps <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> component,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true"></a>        <span class="dt">y =</span> value,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true"></a>        <span class="dt">color =</span> component,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true"></a>        <span class="dt">fill =</span> component),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true"></a>    <span class="dt">outlier.alpha =</span> <span class="fl">0.3</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;steelblue2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>),</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Education&quot;</span>, <span class="st">&quot;Health&quot;</span>, <span class="st">&quot;Income&quot;</span>),</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true"></a>    <span class="dt">name =</span> <span class="st">&quot;Component: &quot;</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;steelblue2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>),</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Education&quot;</span>, <span class="st">&quot;Health&quot;</span>, <span class="st">&quot;Income&quot;</span>),</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true"></a>    <span class="dt">name =</span> <span class="st">&quot;Component: &quot;</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">11</span>,<span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true"></a>    <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true"></a>    <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true"></a>    <span class="dt">panel.grid.minor.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true"></a>    <span class="dt">panel.grid.major.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true"></a>    <span class="dt">axis.ticks.x =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey90&quot;</span>),</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true"></a>    <span class="dt">axis.line.x.bottom =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey90&quot;</span>),</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true"></a>    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="assets/img/component%20boxplots-1.png" width="672" /></p>
<p>This looks pretty good to me. It closely follows the visualization on <a href="https://mk0moaorgidkh7gsb4pe.kinstacdn.com/wp-content/uploads/2009/05/measureofamerica_methodology.pdf">page 210 of the original report’s methodology section</a> (<a href="https://web.archive.org/web/20190616184126/https://mk0moaorgidkh7gsb4pe.kinstacdn.com/wp-content/uploads/2009/05/measureofamerica_methodology.pdf">archive</a>). There are some outliers above 10 on the Education Index, but that’s OK since they probably represent advances beyond the goalposts set in 2005 (which, remember, appear to have been set from state-level aggregates).</p>
<p>So now, at long last, we’ll construct our Modified HDI:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true"></a>cnty &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mhdi =</span> (health_index <span class="op">*</span><span class="st"> </span>educ_index <span class="op">*</span><span class="st"> </span>inc_index)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true"></a><span class="kw">summary</span>(cnty<span class="op">$</span>mhdi)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true"></a><span class="co">##   2.093   4.319   4.793   4.855   5.312   8.761</span></span></code></pre></div>
<p>And lastly, a distribution visualiztion. This is a favorite of mine, with a density area plot and a boxplot as a rug. I plan to cover this viz in detail in a separate (shorter!) post.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a><span class="co"># get stats to use in boxplot</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true"></a>hdibp &lt;-<span class="st"> </span><span class="kw">boxplot</span>(cnty<span class="op">$</span>mhdi, <span class="dt">plot =</span> F)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true"></a><span class="st">  </span><span class="co"># reference normal distribution density line plot</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">stat_density</span>(</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true"></a>    <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">3142</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true"></a>                  <span class="dt">mean =</span> <span class="kw">mean</span>(cnty<span class="op">$</span>mhdi),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true"></a>                  <span class="dt">sd =</span> <span class="kw">sd</span>(cnty<span class="op">$</span>mhdi)),</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true"></a>        <span class="dt">color =</span> <span class="st">&quot;Simulated Normal&quot;</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true"></a>    ),</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="dv">1</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true"></a><span class="st">  </span><span class="co"># observed density line plot</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">stat_density</span>(</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true"></a>    <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true"></a>    <span class="kw">aes</span>(</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true"></a>      <span class="dt">x =</span> cnty<span class="op">$</span>mhdi,</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true"></a>      <span class="dt">color =</span> <span class="st">&quot;mHDI&quot;</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true"></a>    ),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="dv">1</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true"></a><span class="st">  </span><span class="co"># fill observed density</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>(</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true"></a>    <span class="dt">data =</span> cnty,</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> mhdi),</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true"></a>    <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="ot">NA</span>,</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true"></a><span class="st">  </span><span class="co"># legend</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;seagreen3&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true"></a><span class="st">  </span><span class="co"># botplot central box</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true"></a><span class="st">  </span><span class="kw">annotate</span>(</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true"></a>    <span class="st">&quot;rect&quot;</span>,</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true"></a>    <span class="dt">xmin =</span> hdibp<span class="op">$</span>stats[<span class="dv">2</span>], <span class="dt">xmax =</span> hdibp<span class="op">$</span>stats[<span class="dv">4</span>],</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true"></a>    <span class="dt">ymin =</span> <span class="fl">-.06</span>, <span class="dt">ymax =</span> <span class="fl">-.02</span>,</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true"></a>    <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true"></a><span class="st">  </span><span class="co"># boxplot median line</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_segment</span>(</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true"></a>    <span class="dt">data =</span> cnty,</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true"></a>    <span class="dt">x =</span> hdibp<span class="op">$</span>stats[<span class="dv">3</span>], <span class="dt">xend =</span> hdibp<span class="op">$</span>stats[<span class="dv">3</span>],</span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="fl">-.06</span>, <span class="dt">yend =</span> <span class="fl">-.02</span>,</span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true"></a><span class="st">  </span><span class="co"># boxplot left whisker</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_segment</span>(</span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true"></a>    <span class="dt">data =</span> cnty,</span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true"></a>    <span class="dt">x =</span> hdibp<span class="op">$</span>stats[<span class="dv">1</span>], <span class="dt">xend =</span> hdibp<span class="op">$</span>stats[<span class="dv">2</span>],</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="fl">-.04</span>, <span class="dt">yend =</span> <span class="fl">-.04</span>,</span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true"></a><span class="st">  </span><span class="co"># boxplot right whisker</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_segment</span>(</span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true"></a>    <span class="dt">data =</span> cnty,</span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true"></a>    <span class="dt">x =</span> hdibp<span class="op">$</span>stats[<span class="dv">4</span>], <span class="dt">xend =</span> hdibp<span class="op">$</span>stats[<span class="dv">5</span>],</span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="fl">-.04</span>, <span class="dt">yend =</span> <span class="fl">-.04</span>,</span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true"></a><span class="st">  </span><span class="co"># boxplot outliers</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true"></a>    <span class="dt">data =</span> <span class="ot">NULL</span>,</span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> hdibp<span class="op">$</span>out, <span class="dt">y =</span> <span class="fl">-0.0398</span>),</span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>,</span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true"></a><span class="st">  </span><span class="co"># x-axis scale</span></span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>,<span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">9.25</span>)) <span class="op">+</span></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true"></a><span class="st">  </span><span class="co"># theme stuff</span></span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Modified HDI&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true"></a>    <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true"></a>    <span class="dt">panel.grid.major.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true"></a>    <span class="dt">panel.grid.minor.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true"></a>    <span class="dt">panel.grid.minor.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true"></a>    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="assets/img/hdi%20viz-1.png" width="672" /></p>
<p>A bit right-skewed, which is probably to be expected.</p>
</div>
</div>






<!-- ======================================================== -->
<!-- END RMD OUTPUT -->



            </div>
            <!-- END COL -->
        </div>
        <!-- END ROW -->
    </div>
    <!-- END CONTAINER -->
</main>
<!-- END MAIN SECTION -->


<!-- FOOTER -->
<footer class="bg-dark text-light" style="min-height: 100px;">
    <div class="container py-4 px-3 px-lg-5">
        <div class="row">
            <div class="col py-3">
                <p class="text-center text-light slab" style="font-size: 12px;">
                    Copyright &copy; 2020 David E. Lambert
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- JQUERY, BOOTSTRAP JS  -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>


<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
>>>>>>> working
